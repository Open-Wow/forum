<!doctype html>
<html dir="ltr" lang="fr">
<head>
<meta charset="utf-8">
<title>Reversing - Le /who sur MoP (Cas pratique) - Open WoW</title>
<link rel="stylesheet" href="../assets/forum-f3bc49bc.css">
<link rel="canonical" href="38-reversing-le-who-sur-mop-cas-pratique.html">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1">
<meta name="description" content="Le forum francophone d&#039;émulation WoW.">
<meta name="theme-color" content="#4D698E">
<link rel="shortcut icon" href="../assets/favicon-19klahq3.png">
<script src="https://www.recaptcha.net/recaptcha/api.js?hl=fr&render=explicit" async defer></script>
</head>
<body>
<div id="app" class="App">
<div id="app-navigation" class="App-navigation"></div>
<div id="drawer" class="App-drawer">
<header id="header" class="App-header">
<div id="header-navigation" class="Header-navigation"></div>
<div class="container">
<h1 class="Header-title">
<a href="https://forum.open-wow.eu" id="home-link">
<img src="../assets/logo-fje1vtuv.png" alt="Open WoW" class="Header-logo">
</a>
</h1>
<div id="header-primary" class="Header-primary"></div>
<div id="header-secondary" class="Header-secondary"></div>
</div>
</header>
</div>
<main class="App-content">
<div id="content"></div>
<div id="flarum-loading" style="display: none">
Chargement…
</div>
<noscript>
    <div class="Alert">
        <div class="container">
            Ce site est optimisé pour être consulté depuis un navigateur moderne dans lequel JavaScript est activé.
        </div>
    </div>
</noscript>
<div id="flarum-loading-error" style="display: none">
<div class="Alert">
<div class="container">
Une erreur est survenue lors de la tentative de chargement de la version complète de ce site. Veuillez purger le cache de votre navigateur et rafraîchir cette page pour tenter de corriger cette erreur.
</div>
</div>
</div>
<noscript id="flarum-content">
    <div class="container">
    <h2>Reversing - Le /who sur MoP (Cas pratique)</h2>

    <div>
                    <div>
                                <h3>Galathil</h3>
                <div class="Post-body">
                    <p><strong>Important :</strong> Ce tutoriel a été rédigé par Nobodie pour le site wow-emu.fr. Je le recopie ici à l'identique, Il se peut que certaines informations soient obsolètes à ce jour. Il manque les images, leurs présences seront cependant signalées dans le texte. Bonne lecture !</p>

<h1>Reversing - Le /who sur MoP (Cas pratique)</h1>
<p><strong>Prélude : Ce sujet n'est pas original, il a été transféré d'un précédent forum d'émulation en date d'Octobre 2013. J'en suis l'auteur, je le transfère donc pour les besoins de ce forum. Bien qu'il soit en partie ré-écrit, il se peut que certains termes soient inadaptés ou ne soient plus d'actualité.</strong></p>

<p>Bonjour à tous,</p>

<p>beaucoup de gens me l'ont demandé, voici un guide explicatif sur le travail que représente le reversing de paquets sur MoP.</p>

<h2>1) Préambule : les impasses de ce guide</h2>

<p>Contrairement à d'habitude, je me dois de faire un préambule car plusieurs points techniques seront occultés par choix. A divers passages de ce guide, je donnerais des valeurs sans expliquer la façon de les obtenir, et cela pour plusieures raisons. Premièrement, nous travaillons actuellement sur une extension attendue qu'est Mists-Of-Pandaria, je ne donnerais donc pas certains éléments pouvant amener certaines personnes sur une piste bien éclairée lorsque nous travaillons dans le noir le plus complet. Deuxièmement, il s'agit ici d'un guide servant à montrer dans les grandes lignes comment se déroule ce travail, les différentes étapes pour corriger une fonctionnalité du jeu, et le temps nécessaire à accomplir chacune de ces étapes. Un tutoriel sera probablement fait plus tard, dans lequel j'entrerais dans les détails pour chacune de ces étapes, mais il s'agit ici d'un guide qui se veut généraliste, à destination d'un grand nombre de lecteurs.</p>

<p>Etant donné le type de connaissances nécessaires à cette partie du développement d'un serveur privé, je présenterais ce guide sous forme d'une suite de captures d'écran suivies d'explications afin d'avoir un visuel sur le travail effectué. Bonne lecture à vous</p>

<h2>2) Prérequis des connaissances nécessaires pour comprendre ce guide</h2>

<p>Il est nécessaire de posséder un minimum de culture générale sur le développement. Je ne reviendrais pas sur les concepts de langage machine, de code assembleur, de gestion de la mémoire, de binaire, d'héxadécimal, de pseudocode, de buffer. Si vous ne connaissez pas ces termes, vous pourrez trouver une explication basique sur wikipedia. Il n'est pas nécessaire de connaître cela dans les détails, un simple survol de ces termes et de leur définition suffira pour ce guide.</p>

<h2>3) le Reversing, qu'est-ce que c'est ?</h2>

<p>Cette deuxième partie pourrait également faire partie du préambule. Comme vous le savez si vous avez déjà lu un de mes guides sur le fonctionnement d'un serveur de jeu, la partie la plus sensible, celle qui met le plus de bâtons dans les roues des développeurs, c'est le protocole de communication entre le client et le serveur. C'est par ce protocole que transitent tous les informations, et généralement ce protocole change à chaque version, obligeant les développeurs à mettre leur serveur à jour pour s'adapter à la dernière version. L'échange client&lt;-&gt; serveur se fait à l'aide de paquets de données. Lorsque ces paquets vont du client vers le serveur, on dit que ce sont des paquets CMSG. Lorsque le sens est inversé, on les appellent des paquets SMSG. La plupart des paquets s'articulent sous une forme simple de "question-réponse". Le client souhaite obtenir des informations -&gt; il envoie un paquet CMSG au serveur. Le serveur traite cette requête via une fonction qu'on appelle un handler, puis renvoie le paquet SMSG contenant les informations souhaitées par le client. Celui-ci traite les informations via un autre handler, puis affiche le résultat en jeu (par exemple, le message d'un NPC, le spell lancé par un joueur, etc).</p>

<p>Le travail de Reversing, au sens large du terme, consiste à exploiter au maximum les données fournies par le client (principalement le code machine du client, mais aussi les DBCs, les MAPs, les messages d'erreurs tels que les Wow Errors, etc) afin de résoudre un problème. Dans notre cas, et dans le cadre de ce guide, nous allons nous limiter au code machine du client que nous désassemblons afin de retrouver le handler client qui envoie un certain message au serveur (et la structure du paquet envoyé), ainsi que le handler client qui reçoit un autre message en provenance du serveur (et la structure du paquet reçu).</p>

<h2>4) Le /Who, un exemple de fonctionnalité simple</h2>

<p>Nous allons prendre en effet la fonctionnalité du /who comme exemple pour ce guide. Il s'agit d'une fonctionnalité simple mettant en scène deux paquets assez courts. Lorsqu'on entre des informations dans la fenêtre du /who, et qu'on clique sur "envoyer", un paquet CMSG est émis vers le serveur. Celui-ci reçoit le message, le parse (cela signifie découper le paquet correctement pour en extraire les variables) via son handler, effectue les requêtes SQL/ingame correspondantes pour obtenir la liste des personnages connectés répondant aux critères de recherches du joueur, puis renvoie un paquet SMSG vers le client contenant toutes ces informations. Le client reçoit alors ce message dans son handler, parse les informations reçues, et affiche la liste des personnages dans son interface.</p>

<h2>5) Les outils nécessaires au Reversing</h2>

<p>Nous allons commencer par les différents logiciels que j'utilise pour travailler. Premièrement, j'utilise QtCreator pour tous mes projets de développement Cpp. C'est cet IDE qui me permet de développer sur Wow.</p>

<p>[Image: 141223063632518797.jpg]</p>

<p>Ensuite, j'utilise un petit logiciel que nous avons développé (l'ensemble de l'équipe du projet Mist-Eria) afin de calculer des valeurs à partir des Opcodes (qui, je le rappelle, servent à identifier un paquet - savoir à quoi il sert, en quelque sorte).</p>

<p>[Image: 141223063632605068.jpg]</p>

<p>La troisième application est un désassembleur. J'utilise pour ma part IDA ainsi que son plugin HexRays qui me permet de décompiler le code machine (= code assembleur) et d'obtenir un pseudocode C pas trop moche.</p>

<p>[Image: 141223064732395959.jpg]</p>

<p>J'utilise également Notepad++ qui me sert de fourre-tout lorsque j'ai besoin d'identifier des textes. Il m'arrive également d'utiliser une feuille et un crayon, mais comme il est difficile d'en faire une capture d'écran, j'espère que vous savez tous de quoi il s'agit</p>

<p>[Image: 141223063632649773.jpg]</p>

<p>J'utilise enfin la console serveur qui va me permettre de visualiser certaines informations en provenance du client. Nous l'utiliserons d'ailleurs juste après, dès la prochaine partie de ce guide.</p>

<p>[Image: 14122306363374784.jpg]</p>

<h2>6) Le paquet CMSG_WHO</h2>

<p>La première étape est d'identifier l'Opcode (qui je le rappelle permet d'identifier le paquet lorsqu'il est envoyé/reçu). Pour cela, rien de plus simple, il suffit de taper /who dans la console pour obtenir la fenêtre du /who, puis de cliquer sur le bouton Envoyer. On obtient alors un message côté serveur qui nous indique avoir reçu un paquet dont l'opcode n'est géré par aucun handler. On peut voir ici qu'il s'agit de l'Opcode 203 (ou 0xCB en héxa).</p>

<p>[Image: 141223063634642741.jpg]</p>

<p>On le garde quelque part sur un papier/un bloc-note pour plus tard.</p>

<p>[Image: 14122306363464632.jpg]</p>

<p>On effectue ensuite une recherche dans IDA pour trouver toutes les occurence de la valeur 0xCB dans le client</p>

<p>[Image: 141223063634574917.jpg]</p>

<p>On obtient 3124 occurences parmi lesquelles se trouve la ligne qui correspond à l'envoi de cette Opcode. Plusieurs techniques nous permettent de rendre cette recherche instantannée, que je ne dévoilerais pas ici. Sachez simplement qu'il est possible de trouver cette information sans erreur directement dans le client.</p>

<p>[Image: 141223063634215062.jpg]</p>

<p>Une fois la bonne occurence trouvée, on accède au code de la fonction dans laquelle on peut effectivement voir un appel à la fonction CDataStore__PutInt32 (qui correspond à l'envoi d'un int32 dans le buffer) avec en paramètre la valeur 203 (qui correspond à l'Opcode trouvé ci-dessus). On voit just en dessous un bout de code barbare (la ligne thiscall avec des DWORD puis v3 + 4). Cette fonction est en fait celle qui générera l'ensemble du paquet CMSG avant envoi vers le serveur. Le problème est que l'appel ne se fait pas directement, il s'agit d'un appel virtuel. Les explications sur l'obtention de l'adresse réelle du handler dépassent le cadre de ce guide, sachez simplement qu'il nous est possible de trouver l'adresse réelle du handler à partir de cette fonction.</p>

<p>[Image: 141223063634729996.jpg]</p>

<p>Nous obtenons l'adresse de la fonction chargée de remplir le paquet identifié par l'opcode 0xCB. Celui-ci contient bien des appels aux fonctions CDataStore__*, nous confirmant que nous sommes bien dans le handler de l'opcode. Voici son code :</p> 

<pre><code>

int __thiscall sub_7114B0(int this, int a2)
{
  int v2; // eax@1                                                                    
  int v3; // esi@1                                                                    
  char v4; // cl@2                                                                    
  int v5; // eax@3                                                                    
  unsigned int v6; // eax@3                                                           
  int v7; // edx@3                                                                    
  char v8; // cl@4                                                                    
  unsigned int v9; // edi@5                                                           
  int v10; // ebx@6                                                                   
  int v11; // eax@7                                                                   
  int v12; // edx@7                                                                   
  char v13; // cl@8                                                                   
  unsigned int v14; // edi@10                                                         
  int v15; // ebx@11                                                                  
  int v16; // eax@12                                                                  
  int v17; // ecx@12                                                                  
  char v18; // dl@13                                                                  
  int v19; // eax@15                                                                  
  char v20; // cl@16                                                                  
  unsigned int v21; // edi@17                                                         
  int v23; // [sp+8h] [bp-10h]@1                                                      
  __int16 v24; // [sp+Ch] [bp-Ch]@1                                                   
  int v25; // [sp+10h] [bp-8h]@1                                                      
  int v26; // [sp+14h] [bp-4h]@1                                                      

  v3 = this;
  CDataStore__PutInt32(*(_DWORD *)(this + 20));
  CDataStore__PutInt32(*(_DWORD *)(v3 + 44));
  CDataStore__PutInt32(*(_DWORD *)(v3 + 16));
  CDataStore__PutInt32(*(_DWORD *)(v3 + 24));
  v2 = v3 + 64;
  v23 = a2;
  v24 = 0;
  LOBYTE(v26) = 0;
  v25 = v3 + 64;
  do
    v4 = *(_BYTE *)v2++;
  while ( v4 );
  sub_702380((int)&amp;v23, v2 - (v3 + 65), v26);
  v6 = *(_DWORD *)(v3 + 28);
  LOBYTE(v26) = 0;
  sub_702260((int)&amp;v23, v6, v26);
  v7 = *(_DWORD *)(v3 + 48);
  LOBYTE(v26) = 0;
  sub_7107F0(v7, v26);
  v5 = v3 + 112;
  LOBYTE(v26) = 0;
  do
    v8 = *(_BYTE *)v5++;
  while ( v8 );
  sub_702410((int)&amp;v23, v5 - (v3 + 113), v26);
  v9 = 0;
  if ( *(_DWORD *)(v3 + 48) )
  {
    v10 = 0;
    do
    {
      v11 = v10 + *(_DWORD *)(v3 + 52);
      LOBYTE(v26) = 0;
      v12 = v11 + 1;
      do
        v13 = *(_BYTE *)v11++;
      while ( v13 );
      sub_702410((int)&amp;v23, v11 - v12, v26);
      ++v9;
      v10 += 128;
    }
    while ( v9 &lt; *(_DWORD *)(v3 + 48) );
  }
  FlushBits((int)&amp;v23);
  v14 = 0;
  if ( *(_DWORD *)(v3 + 48) )
  {
    v15 = 0;
    do
    {
      v17 = v15 + *(_DWORD *)(v3 + 52);
      v16 = v17;
      v26 = v17 + 1;
      do
        v18 = *(_BYTE *)v16++;
      while ( v18 );
      CDataStore__PutData(v17, v16 - v26);
      ++v14;
      v15 += 128;
    }
    while ( v14 &lt; *(_DWORD *)(v3 + 48) );
  }
  v19 = v3 + 112;
  do
    v20 = *(_BYTE *)v19++;
  while ( v20 );
  CDataStore__PutData(v3 + 112, v19 - (v3 + 113));
  v21 = 0;
  if ( *(_DWORD *)(v3 + 28) )
  {
    do
      CDataStore__PutInt32(*(_DWORD *)(*(_DWORD *)(v3 + 32) + 4 * v21++));
    while ( v21 &lt; *(_DWORD *)(v3 + 28) );
  }
  return CDataStore__PutData(v25, strlen((const char *)v25));
}</code><script async="" crossorigin="anonymous" data-hljs-style="github-gist" integrity="sha384-eud4nQrKZMwcYak7or3J5ZPJx1x4HRe8iTTHJy1SUVrDD+fP30Bo/F8OSdQJpk8d" onload="hljsLoader.highlightBlocks(this.parentNode)" src="https://cdn.jsdelivr.net/gh/s9e/hljs-loader@1.0.18/loader.min.js"></script></pre>

<p>[Image: 141223063635253972.jpg]</p>

<p>Jusqu'à présent, cette recherche a été quasiment instantannée (moins d'une minute pour atteindre ce handler. Mais les choses vont vite se compliquer. Maintenant que nous avons identifié le handler, il nous faut identifier la structure. Cela se fait en plusieurs parties. Premièrement nous créons une structure dans IDA nous facilitant la tâche d'identification.</p>

<p>[Image: 141223063634964691.jpg][Image: 141223063635198665.jpg]</p>

<p>A présent, il nous faut identifier la structure du paquet. Cela nous permet de savoir comment agencer les données. Pour un paquet de cette taille, cela prend environ 10 minutes en étant expérimentés. A l'époque ou nous avons travaillé dessus, nous débutions dans ce domaine et il nous a fallu près de 4 heures. Cette étape nous permet uniquement de trouver la structure, nous ne savons pas encore quelles données mettre à quelle place. J'élude la partie sur la recherche, mais il s'agit uniquement de lecture du code source, de compréhension du pseudocode, du langage assembleur parfois, et d'une certaine pratique et d'une logique de développement.</p>

<p>[Image: 141223063635588268.jpg]</p>

<p>Après ce travail sur la structure, il nous faut identifier les données à insérer à chaque endroit. Je ne donnerais pas la technique pour le faire, mais il faut compter une trentaine de minutes pour tout identifier. Là encore, tout est question de pratiques, les premiers paquets ont mis bien plus longtemps. A ce moment du code, nous pensons avoir la bonne structure, mais rien ne nous permet de confirmer cela. Le seul moyen d'en être sûrs est de patienter jusqu'à la fin pour bien vérifier que le comportement du /who est correct. Ce code source est celui implanté directement dans le serveur.</p>

<p>[Image: 141223063635824483.jpg]</p>

<p>L'ensemble de ces étapes nous a permis de trouver la structure du paquet CMSG_WHO en une quarantaine de minutes.</p>

<h2>7) Le paquet SMSG_WHO</h2>

<p>Maintenant que nous avons (peut-être correctement) identifié le paquet client, il nous faut trouver le paquet serveur pour envoyer la réponse au client. Ici, je vais donner immédiatement la valeur de l'Opcode sans dévoiler la façon de le trouver. Les opcodes serveur sont effectivement plus complexes à trouver que les opcodes client et les façons de les identifier dépassent le cadre de ce guide, tout en étant trop critiques pour être dévoilées pour l'instant. Il s'agit donc de l'Opcode 4433 (0x1151 en héxadécimal).</p>

<p>[Image: 141223063635550229.jpg]</p>

<p>L'ensemble des paquets serveurs passent par la même fonction appelée le ProcessMessage que vous pouvez trouver ici :</p>
<pre><code>

void __thiscall NetClient__ProcessMessage(void *this, int a2, unsigned int a3, int a4)
{
  int v4; // ebx@1                                                            
  void *v5; // edi@1                                                          
  unsigned int v6; // esi@1                                                   
  unsigned int v7; // eax@7                                                   
  unsigned int v8; // eax@11                                                  
  int v9; // ecx@12                                                           

  ++dword_10A0E64;
  v4 = a3;
  v5 = this;
  CDataStore__GetInt32(a3, (int)&amp;a3);
  v6 = a3;
  if ( a3 &amp; 0x80A )
  {
    if ( (a3 &amp; 0xA58) == 2120 )
    {
      sub_7221C0(v5, 0, a2, a3, v4);
    }
    else
    {
      if ( (a3 &amp; 0x248) == 520 )
      {
        JAM_ProcessMovement(v5, 0, a2, a3, v4);
      }
      else
      {
        v7 = a3 &amp; 0x90A;
        if ( v7 == 2304 )
        {
          JAM_ProcessQuest(v5, 0, a2, a3, v4);
        }
        else
        {
          if ( v7 == 2048 )
          {
            JAM_ProcessSpell(v5, 0, a2, a3, v4);
          }
          else
          {
            (*(void (__thiscall **)(void *, unsigned int))(*(_DWORD *)v5 + 68))(v5, a3);
            v8 = v6 &amp; 1 | ((v6 &amp; 4 | ((v6 &amp; 0x30 | (v6 &gt;&gt; 1) &amp; 0x7FC0) &gt;&gt; 1)) &gt;&gt; 1);
            if ( (v6 &amp; 0x4A) == 2 &amp;&amp; (v9 = *((_DWORD *)v5 + v8 + 340)) != 0 )
              ((void (__cdecl *)(_DWORD, unsigned int, int, int))(v9 - ((v6 | (v6 &lt;&lt; 16)) ^ 0x62A3A31D)))(
                *((_DWORD *)v5 + v8 + 2388),
                v6,
                a2,
                v4);
            else
              (*(void (__thiscall **)(int))(*(_DWORD *)v4 + 24))(v4);
          }
        }
      }
    }
  }
  else
  {
    JAM_ClientDispatch(0, a2, a3, v4);
  }
}</code><script async="" crossorigin="anonymous" data-hljs-style="github-gist" integrity="sha384-eud4nQrKZMwcYak7or3J5ZPJx1x4HRe8iTTHJy1SUVrDD+fP30Bo/F8OSdQJpk8d" onload="hljsLoader.highlightBlocks(this.parentNode)" src="https://cdn.jsdelivr.net/gh/s9e/hljs-loader@1.0.18/loader.min.js"></script></pre>
<p>Cette fonction effectue différents calculs sur l'opcode afin de le rediriger vers différentes fonctions chargées de traiter chaque paquet.</p>

<p>[Image: 141223063636716227.jpg]</p>

<p>Afin de trouver la sub (le handler) correspondante au paquet serveur, nous utilisons notre logiciel OpcodeTool afin de calculer différentes valeurs que nous appelons Offsets. Cela nous amène à une fonction contenant un switch. Dans ce switch, nous retrouvons l'Offset trouvé, qui nous indique directement la fonction appelée.</p>

<p>[Image: 141223063636106990.jpg] [Image: 141223063635874786.jpg]</p>

<p>Une fois la sub identifiée, nous arrivons à la sub principale qui initialise quelques données. Cette fonction ne nous intéresse pas, nous poursuivons notre chemin vers la sub suivante indiquée en rouge sur l'image.</p>

<p>[Image: 141223063636229429.jpg]</p>

<p>Nous arrivons enfin au handler gérant le paquet SMSG_WHO. Son code se trouve ici :</p> 
<pre><code>

int __thiscall sub_7DE9E0(void *this, int a2, int a3)
{
  int result; // eax@1                                                                
  int v4; // ebx@1                                                                    
  unsigned int v5; // edi@1                                                           
  void *v6; // esi@1                                                                  
  int v7; // edx@1                                                                    
  unsigned int v8; // ecx@3                                                           
  int v9; // ecx@6                                                                    
  int v10; // edi@9                                                                   
  int v11; // eax@10                                                                  
  int v12; // ecx@10                                                                  
  int v13; // edx@10                                                                  
  int v14; // edi@11                                                                  
  int v15; // edx@12                                                                  
  int v16; // edx@12                                                                  
  int v17; // [sp+Ch] [bp-10h]@1                                                      
  __int16 v18; // [sp+10h] [bp-Ch]@1                                                  
  int v19; // [sp+14h] [bp-8h]@10                                                     
  int v20; // [sp+18h] [bp-4h]@1                                                      

  v4 = a2;
  v6 = this;
  v20 = 0;
  CDataStore__GetInt32(a2, (int)&amp;v20);
  LOBYTE(a2) = 0;
  v7 = a2;
  *((_DWORD *)v6 + 8) = v20;
  v17 = v4;
  v18 = 2048;
  result = sub_733B60(&amp;v17, v7);
  v5 = result;
  if ( (unsigned int)result &gt; *((_DWORD *)v6 + 4) )
  {
    if ( (unsigned int)result &gt; *((_DWORD *)v6 + 6) )
    {
      v8 = *((_DWORD *)v6 + 7);
      if ( !v8 )
        v8 = sub_75E730(result);
      if ( v5 % v8 )
        v9 = v5 + v8 - v5 % v8;
      else
        v9 = v5;
      result = sub_7B1820(v9);
    }
  }
  *((_DWORD *)v6 + 4) = v5;
  v10 = 0;
  a2 = 0;
  if ( *((_DWORD *)v6 + 4) )
  {
    do
    {
      LOBYTE(v20) = 0;
      v11 = sub_70A730(v20);
      v12 = *((_DWORD *)v6 + 5);
      LOBYTE(v19) = 0;
      v13 = v19;
      *(_DWORD *)(v10 + v12) = v11;
      *(_DWORD *)(v10 + *((_DWORD *)v6 + 5) + 48) = CDataStore__Read7Bits((int)&amp;v17, v13);
      result = a2 + 1;
      v10 += 164;
      a2 = result;
    }
    while ( (unsigned int)result &lt; *((_DWORD *)v6 + 4) );
  }
  v14 = 0;
  v20 = 0;
  if ( *((_DWORD *)v6 + 4) )
  {
    do
    {
      v15 = *((_DWORD *)v6 + 5);
      a2 = *(_DWORD *)(v14 + v15 + 48);
      CDataStore__ReadStringWithSize(v4, (void *)(v14 + v15 + 48), a2);
      *(_BYTE *)(v14 + *((_DWORD *)v6 + 5) + a2 + 48) = 0;
      v16 = *((_DWORD *)v6 + 5);
      a2 = *(_DWORD *)(v14 + v16);
      CDataStore__ReadStringWithSize(v4, (void *)(v14 + v16), a2);
      *(_BYTE *)(v14 + *((_DWORD *)v6 + 5) + a2) = 0;
      a2 = 0;
      CDataStore__GetInt32(v4, (int)&amp;a2);
      *(_DWORD *)(v14 + *((_DWORD *)v6 + 5) + 148) = a2;
      a2 = 0;
      CDataStore__GetInt32(v4, (int)&amp;a2);
      *(_DWORD *)(v14 + *((_DWORD *)v6 + 5) + 152) = a2;
      BYTE3(a2) = 0;
      CDataStore__GetInt8(v4, (int)((char *)&amp;a2 + 3));
      *(_BYTE *)(v14 + *((_DWORD *)v6 + 5) + 156) = BYTE3(a2);
      a2 = 0;
      CDataStore__GetInt32(v4, (int)&amp;a2);
      *(_DWORD *)(v14 + *((_DWORD *)v6 + 5) + 144) = a2;
      a2 = 0;
      CDataStore__GetInt32(v4, (int)&amp;a2);
      *(_DWORD *)(v14 + *((_DWORD *)v6 + 5) + 160) = a2;
      result = v20 + 1;
      v14 += 164;
      v20 = result;
    }
    while ( (unsigned int)result &lt; *((_DWORD *)v6 + 4) );
  }
  return result;
}</code><script async="" crossorigin="anonymous" data-hljs-style="github-gist" integrity="sha384-eud4nQrKZMwcYak7or3J5ZPJx1x4HRe8iTTHJy1SUVrDD+fP30Bo/F8OSdQJpk8d" onload="hljsLoader.highlightBlocks(this.parentNode)" src="https://cdn.jsdelivr.net/gh/s9e/hljs-loader@1.0.18/loader.min.js"></script></pre>

<p>[Image: 141223063636817258.jpg]</p>

<p>A cette étape, le travail est identique au CMSG. Il nous faut dans un premier temps identifier la structure, chose faite en une dizaine de minutes.</p>

<p>[Image: 141223063636356255.jpg]</p>

<p>Une fois la structure identifiée, il faut identifier les données à insérer. Cela se fait à nouveau en une trentaine de minutes avec la pratique. A ce stade, nous avons terminé le travail de reversing.</p>

<p>[Image: 141223063637109023.jpg]</p>

<p>Si le travail a été fait correctement, il ne reste plus qu'à profiter du résultat et à admirer une belle liste des personnages connectés, ici Teraah et moi-même pour l'exemple. Voilà le fruit d'un peu moins de deux heures de travail pour gérer la fonctionnalité du /WHO.</p>

<p>[Image: 141223063636872671.jpg]</p>


<h2>8) Généralisation du reversing à l'ensemble des paquets</h2>

<p>Maintenant que vous avez conscience du travail effectué pour corriger une fonctionnalité simple telle que le /WHO, il est de mon devoir de rappeler la totalité du travail à accomplir. Premièrement, il existe environ 2500 paquets à corriger. Nous en avons vu 2 ensemble au travers de ce guide. Ensuite, il s'agit d'un système assez simple. Le fait que ce soit un paquet très visuel (on clique sur un bouton, le paquet est envoyé. On envoie le message, le paquet est reçu) nous permet de tester très facilement les différentes valeurs envoyés. Cela raccourcit grandement les étapes d'identification des variables qui prennent tout de même 30 minutes avec cette facilité. Je vous laisse imaginer ce qui arrive lorsque les paquets sont des paquets "invisibles" tels que tous les paquets envoyés avant l'accès au jeu (connexion au serveur) ou encore les systèmes nécessitant plusieurs envois/réceptions de messages (le système de quêtes par exemple nécessite près de 10 paquets différents pour afficher la quête dans son journal). Ensuite, les handlers de ces deux paquets sont relativement cours, avec moins de 200 lignes environ. Il faut savoir que les handlers de certains paquets de quêtes, de déplacement, ou de spells, font plus de 3000 lignes. Vous comprendrez que le risque d'erreur est très grand et qu'il arrive souvent de devoir relire plusieurs fois le handler pour ne louper aucune variable. Enfin, il s'agissait ici de variables plutôt simples à trouver, car l'ancien système de /who (des version Cataclysm) était semblable à celui-ci. Imaginez le travail lorsqu'il s'agit de paquets totalement inconnus, tels que le système de bataille de Pets par exemple.</p>

<p>Malgré la complexité et le côté fastidieux du reversing, sachez que c'est vraiment la partie la plus plaisante du travail car c'est à ce moment qu'on apprend le plus. On comprend comment fonctionne le jeu, mais également l'ordinateur, la mémoire, et tout ce qui fait tourner un tel système. En comprenant ce système, vous êtes rompus à toutes les situations de développement et c'est un pur bonheur que de réussir à passer outre la complexité pour que le client affiche ce que vous souhaitez.</p>

<p>C'est ici que s'achève ce guide plutôt long. Comme d'habitude, j'espère obtenir de nombreuses remarques constructives afin d'améliorer les points sensibles et de faire en sorte que ce guide soit accessible au moins chevronné des développeurs.</p>

<p>Merci de m'avoir lu jusqu'au bout.</p> 
                </div>
            </div>

            <hr>
            </div>

    
    </div>

</noscript>
<div class="App-composer">
<div class="container">
<div id="composer"></div>
</div>
</div>
</main>
</div>
<div id="modal"></div>
<div id="alerts"></div>
<script>
            document.getElementById('flarum-loading').style.display = 'block';
            var flarum = {extensions: {}};
        </script>
<script src="../assets/forum-b5119be6.js"></script>
<script src="../assets/forum-fr-7d26b6c9.js"></script>
<script>
            document.getElementById('flarum-loading').style.display = 'none';

            try {
                flarum.core.app.load({"resources":[{"type":"forums","id":"1","attributes":{"title":"Open WoW","description":"Le forum francophone d\u0027\u00e9mulation WoW.","showLanguageSelector":true,"baseUrl":"https:\/\/forum.open-wow.eu","basePath":"","debug":false,"apiUrl":"https:\/\/forum.open-wow.eu\/api","welcomeTitle":"Bienvene sur Open WoW","welcomeMessage":"Le forum francophone d\u0027\u00e9mulation WoW.","themePrimaryColor":"#4D698E","themeSecondaryColor":"#4D698E","logoUrl":"https:\/\/forum.open-wow.eu\/assets\/logo-fje1vtuv.png","faviconUrl":"https:\/\/forum.open-wow.eu\/assets\/favicon-19klahq3.png","headerHtml":null,"footerHtml":null,"allowSignUp":true,"defaultRoute":"\/all","canViewDiscussions":true,"canStartDiscussion":true,"canViewUserList":false,"canViewFlags":false,"guidelinesUrl":null,"minPrimaryTags":"1","maxPrimaryTags":"1","minSecondaryTags":"0","maxSecondaryTags":"99","canSeeUserDirectoryLink":false,"userDirectoryDefaultSort":"username_az","darkMode":true,"categories.keepTagsNav":false,"categories.fullPageDesktop":false,"categories.compactMobile":false,"categories.parentRemoveIcon":false,"categories.parentRemoveDescription":false,"categories.parentRemoveStats":false,"categories.parentRemoveLastDiscussion":false,"categories.childBareIcon":false,"fof-upload.canUpload":false,"fof-upload.canDownload":false,"emojioneAreaEnableSearch":true,"emojioneAreaEnableRecent":true,"emojioneAreaEnableTones":true,"emojioneAreaFiltersPositionBottom":false,"emojioneAreaSearchPositionBottom":false,"emojioneAreaHideFlarumButton":true},"relationships":{"groups":{"data":[{"type":"groups","id":"1"},{"type":"groups","id":"2"},{"type":"groups","id":"3"},{"type":"groups","id":"4"}]},"tags":{"data":[{"type":"tags","id":"1"},{"type":"tags","id":"2"},{"type":"tags","id":"3"},{"type":"tags","id":"9"},{"type":"tags","id":"10"},{"type":"tags","id":"11"},{"type":"tags","id":"12"},{"type":"tags","id":"13"},{"type":"tags","id":"14"},{"type":"tags","id":"15"},{"type":"tags","id":"16"},{"type":"tags","id":"17"},{"type":"tags","id":"18"},{"type":"tags","id":"19"},{"type":"tags","id":"20"},{"type":"tags","id":"21"},{"type":"tags","id":"23"},{"type":"tags","id":"24"},{"type":"tags","id":"25"},{"type":"tags","id":"26"},{"type":"tags","id":"27"},{"type":"tags","id":"28"},{"type":"tags","id":"29"},{"type":"tags","id":"30"},{"type":"tags","id":"31"},{"type":"tags","id":"32"},{"type":"tags","id":"33"},{"type":"tags","id":"34"},{"type":"tags","id":"35"},{"type":"tags","id":"36"},{"type":"tags","id":"37"},{"type":"tags","id":"38"},{"type":"tags","id":"39"},{"type":"tags","id":"40"},{"type":"tags","id":"42"},{"type":"tags","id":"43"}]}}},{"type":"groups","id":"1","attributes":{"nameSingular":"Administrateur","namePlural":"Administrateurs","color":"#B72A2A","icon":"fas fa-wrench","isHidden":0}},{"type":"groups","id":"2","attributes":{"nameSingular":"Invit\u00e9","namePlural":"Invit\u00e9s","color":null,"icon":null,"isHidden":0}},{"type":"groups","id":"3","attributes":{"nameSingular":"Membre","namePlural":"Membres","color":null,"icon":null,"isHidden":0}},{"type":"groups","id":"4","attributes":{"nameSingular":"Mod\u00e9rateur","namePlural":"Mod\u00e9rateurs","color":"#80349E","icon":"fas fa-bolt","isHidden":0}},{"type":"tags","id":"1","attributes":{"name":"General","description":null,"slug":"general","color":"#888","backgroundUrl":null,"backgroundMode":null,"icon":null,"discussionCount":0,"position":0,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-02-20T11:54:25+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":4},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"93"}}}},{"type":"tags","id":"2","attributes":{"name":"Tutoriels","description":"","slug":"tutoriels","color":"#e74c3c","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":74,"position":2,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-03-12T17:42:30+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":56},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"97"}}}},{"type":"tags","id":"3","attributes":{"name":"Partages","description":"","slug":"partagess","color":"#e74c3c","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":48,"position":3,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-03-06T15:27:50+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":44},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"96"}}}},{"type":"tags","id":"9","attributes":{"name":"Support","description":"","slug":"support","color":"#e74c3c","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":1,"position":4,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-01-04T17:18:38+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":8},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"28"}}}},{"type":"tags","id":"10","attributes":{"name":"C++","description":"","slug":"tuto-cpp","color":"#e74c3c","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":15,"position":1,"defaultSort":null,"isChild":true,"isHidden":false,"lastPostedAt":"2021-03-12T17:42:30+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":10},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"97"}},"parent":{"data":{"type":"tags","id":"2"}}}},{"type":"tags","id":"11","attributes":{"name":"Lua","description":"","slug":"tuto-lua","color":"#e74c3c","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":11,"position":2,"defaultSort":null,"isChild":true,"isHidden":false,"lastPostedAt":"2021-02-20T11:44:57+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":9},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"92"}},"parent":{"data":{"type":"tags","id":"2"}}}},{"type":"tags","id":"12","attributes":{"name":"SQL","description":"","slug":"tuto-sql","color":"#e74c3c","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":20,"position":4,"defaultSort":null,"isChild":true,"isHidden":false,"lastPostedAt":"2021-02-18T21:50:53+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":12},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"88"}},"parent":{"data":{"type":"tags","id":"2"}}}},{"type":"tags","id":"13","attributes":{"name":"Vanilla","description":"","slug":"vanilla","color":"#f39c12","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":12,"position":null,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-01-07T13:34:50+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":13},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"31"}}}},{"type":"tags","id":"14","attributes":{"name":"The Burning Crusade","description":"","slug":"the-burning-crusade","color":"#f39c12","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":15,"position":null,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-02-28T09:19:19+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":16},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"95"}}}},{"type":"tags","id":"15","attributes":{"name":"Wrath of the Lich King","description":"","slug":"wrath-of-the-lich-king","color":"#f39c12","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":30,"position":null,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-03-06T15:27:50+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":32},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"96"}}}},{"type":"tags","id":"16","attributes":{"name":"Cataclysm","description":"","slug":"cataclysm","color":"#f39c12","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":4,"position":null,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-02-18T21:14:17+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":3},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"68"}}}},{"type":"tags","id":"17","attributes":{"name":"Mists of Pandaria","description":"","slug":"mists-of-pandaria","color":"#f39c12","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":3,"position":null,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-02-18T21:17:59+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":2},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"69"}}}},{"type":"tags","id":"18","attributes":{"name":"Warlords of Draenor","description":"","slug":"warlords-of-draenor","color":"#f39c12","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":3,"position":null,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-02-18T21:17:59+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":2},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"69"}}}},{"type":"tags","id":"19","attributes":{"name":"Legion","description":"","slug":"legion","color":"#f39c12","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":3,"position":null,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-02-18T21:17:59+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":2},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"69"}}}},{"type":"tags","id":"20","attributes":{"name":"Battle for Azeroth","description":"","slug":"battle-for-azeroth","color":"#f39c12","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":3,"position":null,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-02-18T21:17:59+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":2},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"69"}}}},{"type":"tags","id":"21","attributes":{"name":"Shadowlands","description":"","slug":"shadowlands","color":"#f39c12","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":4,"position":null,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-02-18T21:17:59+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":3},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"69"}}}},{"type":"tags","id":"23","attributes":{"name":"TrinityCore","description":"","slug":"trinitycore","color":"#9b59b6","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":31,"position":null,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-03-06T15:27:50+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":30},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"96"}}}},{"type":"tags","id":"24","attributes":{"name":"MaNGOS","description":"","slug":"mangos","color":"#9b59b6","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":12,"position":null,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-02-20T11:44:57+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":13},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"92"}}}},{"type":"tags","id":"25","attributes":{"name":"AzerothCore","description":"","slug":"azerothcore","color":"#9b59b6","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":23,"position":null,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-03-06T15:27:50+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":20},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"96"}}}},{"type":"tags","id":"26","attributes":{"name":"Skyfire","description":"","slug":"skyfire","color":"#9b59b6","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":3,"position":null,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-01-05T13:08:13+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":2},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"30"}}}},{"type":"tags","id":"27","attributes":{"name":"Oregoncore","description":"","slug":"oregoncore","color":"#9b59b6","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":7,"position":null,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-01-07T13:34:50+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":10},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"31"}}}},{"type":"tags","id":"28","attributes":{"name":"C++","description":"","slug":"cplusplus","color":"#2e86c1","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":2,"position":null,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-01-09T16:29:34+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":3},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"42"}}}},{"type":"tags","id":"29","attributes":{"name":"SQL","description":"","slug":"sql","color":"#2e86c1","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":10,"position":null,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-03-06T15:27:50+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":11},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"96"}}}},{"type":"tags","id":"30","attributes":{"name":"Lua","description":"","slug":"lua","color":"#2e86c1","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":16,"position":null,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-02-20T11:44:57+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":16},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"92"}}}},{"type":"tags","id":"31","attributes":{"name":"PHP","description":"","slug":"php","color":"#2e86c1","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":0,"position":null,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":null,"canStartDiscussion":false,"canAddToDiscussion":false,"postCount":0}},{"type":"tags","id":"32","attributes":{"name":"C++","description":"","slug":"rel-cpp","color":"#e74c3c","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":3,"position":1,"defaultSort":null,"isChild":true,"isHidden":false,"lastPostedAt":"2021-02-18T21:23:41+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":2},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"72"}},"parent":{"data":{"type":"tags","id":"3"}}}},{"type":"tags","id":"33","attributes":{"name":"Lua","description":"","slug":"rel-lua","color":"#e74c3c","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":18,"position":2,"defaultSort":null,"isChild":true,"isHidden":false,"lastPostedAt":"2021-02-18T21:49:19+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":17},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"85"}},"parent":{"data":{"type":"tags","id":"3"}}}},{"type":"tags","id":"34","attributes":{"name":"SQL","description":"","slug":"rel-sql","color":"#e74c3c","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":9,"position":4,"defaultSort":null,"isChild":true,"isHidden":false,"lastPostedAt":"2021-03-06T15:27:50+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":9},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"96"}},"parent":{"data":{"type":"tags","id":"3"}}}},{"type":"tags","id":"35","attributes":{"name":"GIT","description":"","slug":"git","color":"#2e86c1","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":1,"position":null,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2020-12-31T12:21:21+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":1},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"8"}}}},{"type":"tags","id":"36","attributes":{"name":"windows","description":"","slug":"windows","color":"#27ae60","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":7,"position":null,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-02-20T11:44:57+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":8},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"92"}}}},{"type":"tags","id":"37","attributes":{"name":"Linux","description":"","slug":"linux","color":"#27ae60","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":6,"position":null,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-02-20T11:44:57+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":6},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"92"}}}},{"type":"tags","id":"38","attributes":{"name":"Guides","description":"","slug":"guides","color":"#00FFF7","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":3,"position":1,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-02-18T21:27:33+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":8},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"76"}}}},{"type":"tags","id":"39","attributes":{"name":"Autres","description":"","slug":"tuto-autres","color":"#e74c3c","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":4,"position":0,"defaultSort":null,"isChild":true,"isHidden":false,"lastPostedAt":"2021-02-28T09:19:19+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":4},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"95"}},"parent":{"data":{"type":"tags","id":"2"}}}},{"type":"tags","id":"40","attributes":{"name":"Autres","description":"","slug":"rel-autres","color":"#e74c3c","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":8,"position":0,"defaultSort":null,"isChild":true,"isHidden":false,"lastPostedAt":"2021-02-20T10:46:15+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":8},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"56"}},"parent":{"data":{"type":"tags","id":"3"}}}},{"type":"tags","id":"42","attributes":{"name":"Model-changing","description":"","slug":"tuto-model-changing","color":"#e74c3c","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":0,"position":3,"defaultSort":null,"isChild":true,"isHidden":false,"lastPostedAt":null,"canStartDiscussion":false,"canAddToDiscussion":false,"postCount":0},"relationships":{"parent":{"data":{"type":"tags","id":"2"}}}},{"type":"tags","id":"43","attributes":{"name":"Model-Changing","description":"","slug":"rel-model-changing","color":"#e74c3c","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":3,"position":3,"defaultSort":null,"isChild":true,"isHidden":false,"lastPostedAt":"2021-02-18T21:41:18+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":2},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"77"}},"parent":{"data":{"type":"tags","id":"3"}}}},{"type":"discussions","id":"93","attributes":{"title":"Le codex","slug":"93-le-codex","commentCount":1,"participantCount":1,"createdAt":"2021-02-20T11:54:25+00:00","lastPostedAt":"2021-02-20T11:54:25+00:00","lastPostNumber":1,"canReply":false,"canRename":false,"canDelete":false,"canHide":false,"isApproved":true,"isLocked":false,"canLock":false,"isSticky":false,"canSticky":false,"subscription":null,"canTag":false},"relationships":{"lastPostedUser":{"data":{"type":"users","id":"2"}}}},{"type":"discussions","id":"97","attributes":{"title":"Pense b\u00eate pour l\u0027execution et la r\u00e9cup\u00e9ration de donn\u00e9es","slug":"97-pense-bete-pour-lexecution-et-la-recuperation-de-donnees","commentCount":1,"participantCount":1,"createdAt":"2021-03-12T17:42:30+00:00","lastPostedAt":"2021-03-12T17:42:30+00:00","lastPostNumber":1,"canReply":false,"canRename":false,"canDelete":false,"canHide":false,"isApproved":true,"isLocked":false,"canLock":false,"isSticky":false,"canSticky":false,"subscription":null,"canTag":false},"relationships":{"lastPostedUser":{"data":{"type":"users","id":"29"}}}},{"type":"discussions","id":"96","attributes":{"title":"SQL-Series","slug":"96-sql-series","commentCount":2,"participantCount":2,"createdAt":"2021-03-06T15:27:50+00:00","lastPostedAt":"2021-03-06T20:11:54+00:00","lastPostNumber":2,"canReply":false,"canRename":false,"canDelete":false,"canHide":false,"isApproved":true,"isLocked":false,"canLock":false,"isSticky":false,"canSticky":false,"subscription":null,"canTag":false},"relationships":{"lastPostedUser":{"data":{"type":"users","id":"13"}}}},{"type":"discussions","id":"28","attributes":{"title":"Comment extraire les Vmaps sur des donjons modifier ?","slug":"28-comment-extraire-les-vmaps-sur-des-donjons-modifier","commentCount":8,"participantCount":4,"createdAt":"2021-01-03T22:30:02+00:00","lastPostedAt":"2021-01-04T19:13:07+00:00","lastPostNumber":8,"canReply":false,"canRename":false,"canDelete":false,"canHide":false,"isApproved":true,"isLocked":true,"canLock":false,"isSticky":false,"canSticky":false,"subscription":null,"canTag":false},"relationships":{"lastPostedUser":{"data":{"type":"users","id":"8"}}}},{"type":"discussions","id":"92","attributes":{"title":"S\u00e9quences d\u0027\u00e9chappement de l\u0027interface utilisateur","slug":"92-sequences-dechappement-de-linterface-utilisateur","commentCount":1,"participantCount":1,"createdAt":"2021-02-20T11:44:57+00:00","lastPostedAt":"2021-02-20T11:44:57+00:00","lastPostNumber":1,"canReply":false,"canRename":false,"canDelete":false,"canHide":false,"isApproved":true,"isLocked":false,"canLock":false,"isSticky":false,"canSticky":false,"subscription":null,"canTag":false},"relationships":{"lastPostedUser":{"data":{"type":"users","id":"2"}}}},{"type":"discussions","id":"88","attributes":{"title":"Changer la faction d\u0027une cr\u00e9ature","slug":"88-changer-la-faction-dune-creature","commentCount":1,"participantCount":1,"createdAt":"2021-02-18T21:50:53+00:00","lastPostedAt":"2021-02-18T21:50:53+00:00","lastPostNumber":1,"canReply":false,"canRename":false,"canDelete":false,"canHide":false,"isApproved":true,"isLocked":false,"canLock":false,"isSticky":false,"canSticky":false,"subscription":null,"canTag":false},"relationships":{"lastPostedUser":{"data":{"type":"users","id":"2"}}}},{"type":"discussions","id":"31","attributes":{"title":"LIC - Lua Icons Chat","slug":"31-lic-lua-icons-chat","commentCount":1,"participantCount":1,"createdAt":"2021-01-07T13:34:50+00:00","lastPostedAt":"2021-01-07T13:34:50+00:00","lastPostNumber":1,"canReply":false,"canRename":false,"canDelete":false,"canHide":false,"isApproved":true,"isLocked":false,"canLock":false,"isSticky":false,"canSticky":false,"subscription":null,"canTag":false},"relationships":{"lastPostedUser":{"data":{"type":"users","id":"2"}}}},{"type":"discussions","id":"95","attributes":{"title":"Montures volantes en Azeroth","slug":"95-montures-volantes-en-azeroth","commentCount":2,"participantCount":2,"createdAt":"2021-02-28T09:19:19+00:00","lastPostedAt":"2021-02-28T19:38:50+00:00","lastPostNumber":2,"canReply":false,"canRename":false,"canDelete":false,"canHide":false,"isApproved":true,"isLocked":false,"canLock":false,"isSticky":false,"canSticky":false,"subscription":null,"canTag":false},"relationships":{"lastPostedUser":{"data":{"type":"users","id":"13"}}}},{"type":"discussions","id":"68","attributes":{"title":"Les conditions","slug":"68-les-conditions","commentCount":1,"participantCount":1,"createdAt":"2021-02-18T21:14:17+00:00","lastPostedAt":"2021-02-18T21:14:17+00:00","lastPostNumber":1,"canReply":false,"canRename":false,"canDelete":false,"canHide":false,"isApproved":true,"isLocked":false,"canLock":false,"isSticky":false,"canSticky":false,"subscription":null,"canTag":false},"relationships":{"lastPostedUser":{"data":{"type":"users","id":"2"}}}},{"type":"discussions","id":"69","attributes":{"title":"Phase des maps en 6x","slug":"69-phase-des-maps-en-6x","commentCount":1,"participantCount":1,"createdAt":"2021-02-18T21:17:59+00:00","lastPostedAt":"2021-02-18T21:17:59+00:00","lastPostNumber":1,"canReply":false,"canRename":false,"canDelete":false,"canHide":false,"isApproved":true,"isLocked":false,"canLock":false,"isSticky":false,"canSticky":false,"subscription":null,"canTag":false},"relationships":{"lastPostedUser":{"data":{"type":"users","id":"2"}}}},{"type":"discussions","id":"30","attributes":{"title":"Modifier la distance de vue","slug":"30-modifier-la-distance-de-vue","commentCount":1,"participantCount":1,"createdAt":"2021-01-05T13:08:13+00:00","lastPostedAt":"2021-01-05T13:08:13+00:00","lastPostNumber":1,"canReply":false,"canRename":false,"canDelete":false,"canHide":false,"isApproved":true,"isLocked":false,"canLock":false,"isSticky":false,"canSticky":false,"subscription":null,"canTag":false},"relationships":{"lastPostedUser":{"data":{"type":"users","id":"2"}}}},{"type":"discussions","id":"42","attributes":{"title":"Les Bitmasks - Fonctionnement et Exemples","slug":"42-les-bitmasks-fonctionnement-et-exemples","commentCount":2,"participantCount":2,"createdAt":"2021-01-09T16:29:34+00:00","lastPostedAt":"2021-02-12T20:57:11+00:00","lastPostNumber":2,"canReply":false,"canRename":false,"canDelete":false,"canHide":false,"isApproved":true,"isLocked":false,"canLock":false,"isSticky":false,"canSticky":false,"subscription":null,"canTag":false},"relationships":{"lastPostedUser":{"data":{"type":"users","id":"13"}}}},{"type":"discussions","id":"72","attributes":{"title":"NPC Respawn","slug":"72-npc-respawn","commentCount":1,"participantCount":1,"createdAt":"2021-02-18T21:23:41+00:00","lastPostedAt":"2021-02-18T21:23:41+00:00","lastPostNumber":1,"canReply":false,"canRename":false,"canDelete":false,"canHide":false,"isApproved":true,"isLocked":false,"canLock":false,"isSticky":false,"canSticky":false,"subscription":null,"canTag":false},"relationships":{"lastPostedUser":{"data":{"type":"users","id":"2"}}}},{"type":"discussions","id":"85","attributes":{"title":"[AIO] - Modificateur de Rates EXP","slug":"85-aio-modificateur-de-rates-exp","commentCount":1,"participantCount":1,"createdAt":"2021-02-18T21:49:19+00:00","lastPostedAt":"2021-02-18T21:49:19+00:00","lastPostNumber":1,"canReply":false,"canRename":false,"canDelete":false,"canHide":false,"isApproved":true,"isLocked":false,"canLock":false,"isSticky":false,"canSticky":false,"subscription":null,"canTag":false},"relationships":{"lastPostedUser":{"data":{"type":"users","id":"2"}}}},{"type":"discussions","id":"8","attributes":{"title":"Cloner une version particuli\u00e8re de TrinityCore","slug":"8-cloner-une-version-particuliere-de-trinitycore","commentCount":1,"participantCount":1,"createdAt":"2020-12-31T12:21:21+00:00","lastPostedAt":"2020-12-31T12:21:21+00:00","lastPostNumber":1,"canReply":false,"canRename":false,"canDelete":false,"canHide":false,"isApproved":true,"isLocked":false,"canLock":false,"isSticky":false,"canSticky":false,"subscription":null,"canTag":false},"relationships":{"lastPostedUser":{"data":{"type":"users","id":"1"}}}},{"type":"discussions","id":"76","attributes":{"title":"Un serveur, fonctionnement g\u00e9n\u00e9ral","slug":"76-un-serveur-fonctionnement-general","commentCount":1,"participantCount":1,"createdAt":"2021-02-18T21:27:33+00:00","lastPostedAt":"2021-02-18T21:27:33+00:00","lastPostNumber":1,"canReply":false,"canRename":false,"canDelete":false,"canHide":false,"isApproved":true,"isLocked":false,"canLock":false,"isSticky":false,"canSticky":false,"subscription":null,"canTag":false},"relationships":{"lastPostedUser":{"data":{"type":"users","id":"2"}}}},{"type":"discussions","id":"56","attributes":{"title":"WoW Admin Panel Prenium","slug":"56-wow-admin-panel-prenium","commentCount":1,"participantCount":1,"createdAt":"2021-02-12T15:47:42+00:00","lastPostedAt":"2021-02-12T15:47:42+00:00","lastPostNumber":1,"canReply":false,"canRename":false,"canDelete":false,"canHide":false,"isApproved":true,"isLocked":false,"canLock":false,"isSticky":false,"canSticky":false,"subscription":null,"canTag":false},"relationships":{"lastPostedUser":{"data":{"type":"users","id":"19"}}}},{"type":"discussions","id":"77","attributes":{"title":"Characters Create \u0026 Select Refoge","slug":"77-characters-create-select-refoge","commentCount":1,"participantCount":1,"createdAt":"2021-02-18T21:41:18+00:00","lastPostedAt":"2021-02-18T21:41:18+00:00","lastPostNumber":1,"canReply":false,"canRename":false,"canDelete":false,"canHide":false,"isApproved":true,"isLocked":false,"canLock":false,"isSticky":false,"canSticky":false,"subscription":null,"canTag":false},"relationships":{"lastPostedUser":{"data":{"type":"users","id":"2"}}}},{"type":"users","id":"2","attributes":{"username":"iThorgrim","displayName":"iThorgrim","avatarUrl":"https:\/\/forum.open-wow.eu\/assets\/avatars\/m2uNfA3ykacYo3KQ.png","slug":"iThorgrim","joinTime":null}},{"type":"users","id":"29","attributes":{"username":"Mithrandir","displayName":"Mithrandir","avatarUrl":null,"slug":"Mithrandir","joinTime":null}},{"type":"users","id":"13","attributes":{"username":"noc","displayName":"noc","avatarUrl":null,"slug":"noc","joinTime":null}},{"type":"users","id":"8","attributes":{"username":"Shard","displayName":"Shard","avatarUrl":"https:\/\/forum.open-wow.eu\/assets\/avatars\/bYoQgxVXNpTYgA1Z.png","slug":"Shard","joinTime":null}},{"type":"users","id":"1","attributes":{"username":"Galathil","displayName":"Galathil","avatarUrl":"https:\/\/forum.open-wow.eu\/assets\/avatars\/6zjneQm6RzYl44hc.png","slug":"Galathil","joinTime":null}},{"type":"users","id":"19","attributes":{"username":"Torvahal","displayName":"Torvahal","avatarUrl":"https:\/\/forum.open-wow.eu\/assets\/avatars\/Zj382QMdGN5T05KR.png","slug":"Torvahal","joinTime":null}}],"session":{"userId":0,"csrfToken":"tvI5BJKWQu1MqYAP7fCat9m3pNA3kABuXPB3vWhS"},"locales":{"fr":"Fran\u00e7ais","en":"English"},"locale":"fr","fof-recaptcha.credentials.site":"6LfKZhoaAAAAALSGOmOPpIVRVM8XRksALQXeFtYW","fof-recaptcha.type":"","apiDocument":{"data":{"type":"discussions","id":"38","attributes":{"title":"Reversing - Le \/who sur MoP (Cas pratique)","slug":"38-reversing-le-who-sur-mop-cas-pratique","commentCount":1,"participantCount":1,"createdAt":"2021-01-09T15:29:00+00:00","lastPostedAt":"2021-01-09T15:29:00+00:00","lastPostNumber":1,"canReply":false,"canRename":false,"canDelete":false,"canHide":false,"isApproved":true,"isLocked":false,"canLock":false,"isSticky":false,"canSticky":false,"subscription":null,"canTag":false},"relationships":{"posts":{"data":[{"type":"posts","id":"64"}]},"tags":{"data":[{"type":"tags","id":"2"}]}}},"included":[{"type":"posts","id":"64","attributes":{"number":1,"createdAt":"2021-01-09T15:29:00+00:00","contentType":"comment","contentHtml":"\u003Cp\u003E\u003Cstrong\u003EImportant :\u003C\/strong\u003E Ce tutoriel a \u00e9t\u00e9 r\u00e9dig\u00e9 par Nobodie pour le site wow-emu.fr. Je le recopie ici \u00e0 l\u0027identique, Il se peut que certaines informations soient obsol\u00e8tes \u00e0 ce jour. Il manque les images, leurs pr\u00e9sences seront cependant signal\u00e9es dans le texte. Bonne lecture !\u003C\/p\u003E\n\n\u003Ch1\u003EReversing - Le \/who sur MoP (Cas pratique)\u003C\/h1\u003E\n\u003Cp\u003E\u003Cstrong\u003EPr\u00e9lude : Ce sujet n\u0027est pas original, il a \u00e9t\u00e9 transf\u00e9r\u00e9 d\u0027un pr\u00e9c\u00e9dent forum d\u0027\u00e9mulation en date d\u0027Octobre 2013. J\u0027en suis l\u0027auteur, je le transf\u00e8re donc pour les besoins de ce forum. Bien qu\u0027il soit en partie r\u00e9-\u00e9crit, il se peut que certains termes soient inadapt\u00e9s ou ne soient plus d\u0027actualit\u00e9.\u003C\/strong\u003E\u003C\/p\u003E\n\n\u003Cp\u003EBonjour \u00e0 tous,\u003C\/p\u003E\n\n\u003Cp\u003Ebeaucoup de gens me l\u0027ont demand\u00e9, voici un guide explicatif sur le travail que repr\u00e9sente le reversing de paquets sur MoP.\u003C\/p\u003E\n\n\u003Ch2\u003E1) Pr\u00e9ambule : les impasses de ce guide\u003C\/h2\u003E\n\n\u003Cp\u003EContrairement \u00e0 d\u0027habitude, je me dois de faire un pr\u00e9ambule car plusieurs points techniques seront occult\u00e9s par choix. A divers passages de ce guide, je donnerais des valeurs sans expliquer la fa\u00e7on de les obtenir, et cela pour plusieures raisons. Premi\u00e8rement, nous travaillons actuellement sur une extension attendue qu\u0027est Mists-Of-Pandaria, je ne donnerais donc pas certains \u00e9l\u00e9ments pouvant amener certaines personnes sur une piste bien \u00e9clair\u00e9e lorsque nous travaillons dans le noir le plus complet. Deuxi\u00e8mement, il s\u0027agit ici d\u0027un guide servant \u00e0 montrer dans les grandes lignes comment se d\u00e9roule ce travail, les diff\u00e9rentes \u00e9tapes pour corriger une fonctionnalit\u00e9 du jeu, et le temps n\u00e9cessaire \u00e0 accomplir chacune de ces \u00e9tapes. Un tutoriel sera probablement fait plus tard, dans lequel j\u0027entrerais dans les d\u00e9tails pour chacune de ces \u00e9tapes, mais il s\u0027agit ici d\u0027un guide qui se veut g\u00e9n\u00e9raliste, \u00e0 destination d\u0027un grand nombre de lecteurs.\u003C\/p\u003E\n\n\u003Cp\u003EEtant donn\u00e9 le type de connaissances n\u00e9cessaires \u00e0 cette partie du d\u00e9veloppement d\u0027un serveur priv\u00e9, je pr\u00e9senterais ce guide sous forme d\u0027une suite de captures d\u0027\u00e9cran suivies d\u0027explications afin d\u0027avoir un visuel sur le travail effectu\u00e9. Bonne lecture \u00e0 vous\u003C\/p\u003E\n\n\u003Ch2\u003E2) Pr\u00e9requis des connaissances n\u00e9cessaires pour comprendre ce guide\u003C\/h2\u003E\n\n\u003Cp\u003EIl est n\u00e9cessaire de poss\u00e9der un minimum de culture g\u00e9n\u00e9rale sur le d\u00e9veloppement. Je ne reviendrais pas sur les concepts de langage machine, de code assembleur, de gestion de la m\u00e9moire, de binaire, d\u0027h\u00e9xad\u00e9cimal, de pseudocode, de buffer. Si vous ne connaissez pas ces termes, vous pourrez trouver une explication basique sur wikipedia. Il n\u0027est pas n\u00e9cessaire de conna\u00eetre cela dans les d\u00e9tails, un simple survol de ces termes et de leur d\u00e9finition suffira pour ce guide.\u003C\/p\u003E\n\n\u003Ch2\u003E3) le Reversing, qu\u0027est-ce que c\u0027est ?\u003C\/h2\u003E\n\n\u003Cp\u003ECette deuxi\u00e8me partie pourrait \u00e9galement faire partie du pr\u00e9ambule. Comme vous le savez si vous avez d\u00e9j\u00e0 lu un de mes guides sur le fonctionnement d\u0027un serveur de jeu, la partie la plus sensible, celle qui met le plus de b\u00e2tons dans les roues des d\u00e9veloppeurs, c\u0027est le protocole de communication entre le client et le serveur. C\u0027est par ce protocole que transitent tous les informations, et g\u00e9n\u00e9ralement ce protocole change \u00e0 chaque version, obligeant les d\u00e9veloppeurs \u00e0 mettre leur serveur \u00e0 jour pour s\u0027adapter \u00e0 la derni\u00e8re version. L\u0027\u00e9change client\u0026lt;-\u0026gt; serveur se fait \u00e0 l\u0027aide de paquets de donn\u00e9es. Lorsque ces paquets vont du client vers le serveur, on dit que ce sont des paquets CMSG. Lorsque le sens est invers\u00e9, on les appellent des paquets SMSG. La plupart des paquets s\u0027articulent sous une forme simple de \u0022question-r\u00e9ponse\u0022. Le client souhaite obtenir des informations -\u0026gt; il envoie un paquet CMSG au serveur. Le serveur traite cette requ\u00eate via une fonction qu\u0027on appelle un handler, puis renvoie le paquet SMSG contenant les informations souhait\u00e9es par le client. Celui-ci traite les informations via un autre handler, puis affiche le r\u00e9sultat en jeu (par exemple, le message d\u0027un NPC, le spell lanc\u00e9 par un joueur, etc).\u003C\/p\u003E\n\n\u003Cp\u003ELe travail de Reversing, au sens large du terme, consiste \u00e0 exploiter au maximum les donn\u00e9es fournies par le client (principalement le code machine du client, mais aussi les DBCs, les MAPs, les messages d\u0027erreurs tels que les Wow Errors, etc) afin de r\u00e9soudre un probl\u00e8me. Dans notre cas, et dans le cadre de ce guide, nous allons nous limiter au code machine du client que nous d\u00e9sassemblons afin de retrouver le handler client qui envoie un certain message au serveur (et la structure du paquet envoy\u00e9), ainsi que le handler client qui re\u00e7oit un autre message en provenance du serveur (et la structure du paquet re\u00e7u).\u003C\/p\u003E\n\n\u003Ch2\u003E4) Le \/Who, un exemple de fonctionnalit\u00e9 simple\u003C\/h2\u003E\n\n\u003Cp\u003ENous allons prendre en effet la fonctionnalit\u00e9 du \/who comme exemple pour ce guide. Il s\u0027agit d\u0027une fonctionnalit\u00e9 simple mettant en sc\u00e8ne deux paquets assez courts. Lorsqu\u0027on entre des informations dans la fen\u00eatre du \/who, et qu\u0027on clique sur \u0022envoyer\u0022, un paquet CMSG est \u00e9mis vers le serveur. Celui-ci re\u00e7oit le message, le parse (cela signifie d\u00e9couper le paquet correctement pour en extraire les variables) via son handler, effectue les requ\u00eates SQL\/ingame correspondantes pour obtenir la liste des personnages connect\u00e9s r\u00e9pondant aux crit\u00e8res de recherches du joueur, puis renvoie un paquet SMSG vers le client contenant toutes ces informations. Le client re\u00e7oit alors ce message dans son handler, parse les informations re\u00e7ues, et affiche la liste des personnages dans son interface.\u003C\/p\u003E\n\n\u003Ch2\u003E5) Les outils n\u00e9cessaires au Reversing\u003C\/h2\u003E\n\n\u003Cp\u003ENous allons commencer par les diff\u00e9rents logiciels que j\u0027utilise pour travailler. Premi\u00e8rement, j\u0027utilise QtCreator pour tous mes projets de d\u00e9veloppement Cpp. C\u0027est cet IDE qui me permet de d\u00e9velopper sur Wow.\u003C\/p\u003E\n\n\u003Cp\u003E[Image: 141223063632518797.jpg]\u003C\/p\u003E\n\n\u003Cp\u003EEnsuite, j\u0027utilise un petit logiciel que nous avons d\u00e9velopp\u00e9 (l\u0027ensemble de l\u0027\u00e9quipe du projet Mist-Eria) afin de calculer des valeurs \u00e0 partir des Opcodes (qui, je le rappelle, servent \u00e0 identifier un paquet - savoir \u00e0 quoi il sert, en quelque sorte).\u003C\/p\u003E\n\n\u003Cp\u003E[Image: 141223063632605068.jpg]\u003C\/p\u003E\n\n\u003Cp\u003ELa troisi\u00e8me application est un d\u00e9sassembleur. J\u0027utilise pour ma part IDA ainsi que son plugin HexRays qui me permet de d\u00e9compiler le code machine (= code assembleur) et d\u0027obtenir un pseudocode C pas trop moche.\u003C\/p\u003E\n\n\u003Cp\u003E[Image: 141223064732395959.jpg]\u003C\/p\u003E\n\n\u003Cp\u003EJ\u0027utilise \u00e9galement Notepad++ qui me sert de fourre-tout lorsque j\u0027ai besoin d\u0027identifier des textes. Il m\u0027arrive \u00e9galement d\u0027utiliser une feuille et un crayon, mais comme il est difficile d\u0027en faire une capture d\u0027\u00e9cran, j\u0027esp\u00e8re que vous savez tous de quoi il s\u0027agit\u003C\/p\u003E\n\n\u003Cp\u003E[Image: 141223063632649773.jpg]\u003C\/p\u003E\n\n\u003Cp\u003EJ\u0027utilise enfin la console serveur qui va me permettre de visualiser certaines informations en provenance du client. Nous l\u0027utiliserons d\u0027ailleurs juste apr\u00e8s, d\u00e8s la prochaine partie de ce guide.\u003C\/p\u003E\n\n\u003Cp\u003E[Image: 14122306363374784.jpg]\u003C\/p\u003E\n\n\u003Ch2\u003E6) Le paquet CMSG_WHO\u003C\/h2\u003E\n\n\u003Cp\u003ELa premi\u00e8re \u00e9tape est d\u0027identifier l\u0027Opcode (qui je le rappelle permet d\u0027identifier le paquet lorsqu\u0027il est envoy\u00e9\/re\u00e7u). Pour cela, rien de plus simple, il suffit de taper \/who dans la console pour obtenir la fen\u00eatre du \/who, puis de cliquer sur le bouton Envoyer. On obtient alors un message c\u00f4t\u00e9 serveur qui nous indique avoir re\u00e7u un paquet dont l\u0027opcode n\u0027est g\u00e9r\u00e9 par aucun handler. On peut voir ici qu\u0027il s\u0027agit de l\u0027Opcode 203 (ou 0xCB en h\u00e9xa).\u003C\/p\u003E\n\n\u003Cp\u003E[Image: 141223063634642741.jpg]\u003C\/p\u003E\n\n\u003Cp\u003EOn le garde quelque part sur un papier\/un bloc-note pour plus tard.\u003C\/p\u003E\n\n\u003Cp\u003E[Image: 14122306363464632.jpg]\u003C\/p\u003E\n\n\u003Cp\u003EOn effectue ensuite une recherche dans IDA pour trouver toutes les occurence de la valeur 0xCB dans le client\u003C\/p\u003E\n\n\u003Cp\u003E[Image: 141223063634574917.jpg]\u003C\/p\u003E\n\n\u003Cp\u003EOn obtient 3124 occurences parmi lesquelles se trouve la ligne qui correspond \u00e0 l\u0027envoi de cette Opcode. Plusieurs techniques nous permettent de rendre cette recherche instantann\u00e9e, que je ne d\u00e9voilerais pas ici. Sachez simplement qu\u0027il est possible de trouver cette information sans erreur directement dans le client.\u003C\/p\u003E\n\n\u003Cp\u003E[Image: 141223063634215062.jpg]\u003C\/p\u003E\n\n\u003Cp\u003EUne fois la bonne occurence trouv\u00e9e, on acc\u00e8de au code de la fonction dans laquelle on peut effectivement voir un appel \u00e0 la fonction CDataStore__PutInt32 (qui correspond \u00e0 l\u0027envoi d\u0027un int32 dans le buffer) avec en param\u00e8tre la valeur 203 (qui correspond \u00e0 l\u0027Opcode trouv\u00e9 ci-dessus). On voit just en dessous un bout de code barbare (la ligne thiscall avec des DWORD puis v3 + 4). Cette fonction est en fait celle qui g\u00e9n\u00e9rera l\u0027ensemble du paquet CMSG avant envoi vers le serveur. Le probl\u00e8me est que l\u0027appel ne se fait pas directement, il s\u0027agit d\u0027un appel virtuel. Les explications sur l\u0027obtention de l\u0027adresse r\u00e9elle du handler d\u00e9passent le cadre de ce guide, sachez simplement qu\u0027il nous est possible de trouver l\u0027adresse r\u00e9elle du handler \u00e0 partir de cette fonction.\u003C\/p\u003E\n\n\u003Cp\u003E[Image: 141223063634729996.jpg]\u003C\/p\u003E\n\n\u003Cp\u003ENous obtenons l\u0027adresse de la fonction charg\u00e9e de remplir le paquet identifi\u00e9 par l\u0027opcode 0xCB. Celui-ci contient bien des appels aux fonctions CDataStore__*, nous confirmant que nous sommes bien dans le handler de l\u0027opcode. Voici son code :\u003C\/p\u003E \n\n\u003Cpre\u003E\u003Ccode\u003E\n\nint __thiscall sub_7114B0(int this, int a2)\n{\n  int v2; \/\/ eax@1                                                                    \n  int v3; \/\/ esi@1                                                                    \n  char v4; \/\/ cl@2                                                                    \n  int v5; \/\/ eax@3                                                                    \n  unsigned int v6; \/\/ eax@3                                                           \n  int v7; \/\/ edx@3                                                                    \n  char v8; \/\/ cl@4                                                                    \n  unsigned int v9; \/\/ edi@5                                                           \n  int v10; \/\/ ebx@6                                                                   \n  int v11; \/\/ eax@7                                                                   \n  int v12; \/\/ edx@7                                                                   \n  char v13; \/\/ cl@8                                                                   \n  unsigned int v14; \/\/ edi@10                                                         \n  int v15; \/\/ ebx@11                                                                  \n  int v16; \/\/ eax@12                                                                  \n  int v17; \/\/ ecx@12                                                                  \n  char v18; \/\/ dl@13                                                                  \n  int v19; \/\/ eax@15                                                                  \n  char v20; \/\/ cl@16                                                                  \n  unsigned int v21; \/\/ edi@17                                                         \n  int v23; \/\/ [sp+8h] [bp-10h]@1                                                      \n  __int16 v24; \/\/ [sp+Ch] [bp-Ch]@1                                                   \n  int v25; \/\/ [sp+10h] [bp-8h]@1                                                      \n  int v26; \/\/ [sp+14h] [bp-4h]@1                                                      \n\n  v3 = this;\n  CDataStore__PutInt32(*(_DWORD *)(this + 20));\n  CDataStore__PutInt32(*(_DWORD *)(v3 + 44));\n  CDataStore__PutInt32(*(_DWORD *)(v3 + 16));\n  CDataStore__PutInt32(*(_DWORD *)(v3 + 24));\n  v2 = v3 + 64;\n  v23 = a2;\n  v24 = 0;\n  LOBYTE(v26) = 0;\n  v25 = v3 + 64;\n  do\n    v4 = *(_BYTE *)v2++;\n  while ( v4 );\n  sub_702380((int)\u0026amp;v23, v2 - (v3 + 65), v26);\n  v6 = *(_DWORD *)(v3 + 28);\n  LOBYTE(v26) = 0;\n  sub_702260((int)\u0026amp;v23, v6, v26);\n  v7 = *(_DWORD *)(v3 + 48);\n  LOBYTE(v26) = 0;\n  sub_7107F0(v7, v26);\n  v5 = v3 + 112;\n  LOBYTE(v26) = 0;\n  do\n    v8 = *(_BYTE *)v5++;\n  while ( v8 );\n  sub_702410((int)\u0026amp;v23, v5 - (v3 + 113), v26);\n  v9 = 0;\n  if ( *(_DWORD *)(v3 + 48) )\n  {\n    v10 = 0;\n    do\n    {\n      v11 = v10 + *(_DWORD *)(v3 + 52);\n      LOBYTE(v26) = 0;\n      v12 = v11 + 1;\n      do\n        v13 = *(_BYTE *)v11++;\n      while ( v13 );\n      sub_702410((int)\u0026amp;v23, v11 - v12, v26);\n      ++v9;\n      v10 += 128;\n    }\n    while ( v9 \u0026lt; *(_DWORD *)(v3 + 48) );\n  }\n  FlushBits((int)\u0026amp;v23);\n  v14 = 0;\n  if ( *(_DWORD *)(v3 + 48) )\n  {\n    v15 = 0;\n    do\n    {\n      v17 = v15 + *(_DWORD *)(v3 + 52);\n      v16 = v17;\n      v26 = v17 + 1;\n      do\n        v18 = *(_BYTE *)v16++;\n      while ( v18 );\n      CDataStore__PutData(v17, v16 - v26);\n      ++v14;\n      v15 += 128;\n    }\n    while ( v14 \u0026lt; *(_DWORD *)(v3 + 48) );\n  }\n  v19 = v3 + 112;\n  do\n    v20 = *(_BYTE *)v19++;\n  while ( v20 );\n  CDataStore__PutData(v3 + 112, v19 - (v3 + 113));\n  v21 = 0;\n  if ( *(_DWORD *)(v3 + 28) )\n  {\n    do\n      CDataStore__PutInt32(*(_DWORD *)(*(_DWORD *)(v3 + 32) + 4 * v21++));\n    while ( v21 \u0026lt; *(_DWORD *)(v3 + 28) );\n  }\n  return CDataStore__PutData(v25, strlen((const char *)v25));\n}\u003C\/code\u003E\u003Cscript async=\u0022\u0022 crossorigin=\u0022anonymous\u0022 data-hljs-style=\u0022github-gist\u0022 integrity=\u0022sha384-eud4nQrKZMwcYak7or3J5ZPJx1x4HRe8iTTHJy1SUVrDD+fP30Bo\/F8OSdQJpk8d\u0022 onload=\u0022hljsLoader.highlightBlocks(this.parentNode)\u0022 src=\u0022https:\/\/cdn.jsdelivr.net\/gh\/s9e\/hljs-loader@1.0.18\/loader.min.js\u0022\u003E\u003C\/script\u003E\u003C\/pre\u003E\n\n\u003Cp\u003E[Image: 141223063635253972.jpg]\u003C\/p\u003E\n\n\u003Cp\u003EJusqu\u0027\u00e0 pr\u00e9sent, cette recherche a \u00e9t\u00e9 quasiment instantann\u00e9e (moins d\u0027une minute pour atteindre ce handler. Mais les choses vont vite se compliquer. Maintenant que nous avons identifi\u00e9 le handler, il nous faut identifier la structure. Cela se fait en plusieurs parties. Premi\u00e8rement nous cr\u00e9ons une structure dans IDA nous facilitant la t\u00e2che d\u0027identification.\u003C\/p\u003E\n\n\u003Cp\u003E[Image: 141223063634964691.jpg][Image: 141223063635198665.jpg]\u003C\/p\u003E\n\n\u003Cp\u003EA pr\u00e9sent, il nous faut identifier la structure du paquet. Cela nous permet de savoir comment agencer les donn\u00e9es. Pour un paquet de cette taille, cela prend environ 10 minutes en \u00e9tant exp\u00e9riment\u00e9s. A l\u0027\u00e9poque ou nous avons travaill\u00e9 dessus, nous d\u00e9butions dans ce domaine et il nous a fallu pr\u00e8s de 4 heures. Cette \u00e9tape nous permet uniquement de trouver la structure, nous ne savons pas encore quelles donn\u00e9es mettre \u00e0 quelle place. J\u0027\u00e9lude la partie sur la recherche, mais il s\u0027agit uniquement de lecture du code source, de compr\u00e9hension du pseudocode, du langage assembleur parfois, et d\u0027une certaine pratique et d\u0027une logique de d\u00e9veloppement.\u003C\/p\u003E\n\n\u003Cp\u003E[Image: 141223063635588268.jpg]\u003C\/p\u003E\n\n\u003Cp\u003EApr\u00e8s ce travail sur la structure, il nous faut identifier les donn\u00e9es \u00e0 ins\u00e9rer \u00e0 chaque endroit. Je ne donnerais pas la technique pour le faire, mais il faut compter une trentaine de minutes pour tout identifier. L\u00e0 encore, tout est question de pratiques, les premiers paquets ont mis bien plus longtemps. A ce moment du code, nous pensons avoir la bonne structure, mais rien ne nous permet de confirmer cela. Le seul moyen d\u0027en \u00eatre s\u00fbrs est de patienter jusqu\u0027\u00e0 la fin pour bien v\u00e9rifier que le comportement du \/who est correct. Ce code source est celui implant\u00e9 directement dans le serveur.\u003C\/p\u003E\n\n\u003Cp\u003E[Image: 141223063635824483.jpg]\u003C\/p\u003E\n\n\u003Cp\u003EL\u0027ensemble de ces \u00e9tapes nous a permis de trouver la structure du paquet CMSG_WHO en une quarantaine de minutes.\u003C\/p\u003E\n\n\u003Ch2\u003E7) Le paquet SMSG_WHO\u003C\/h2\u003E\n\n\u003Cp\u003EMaintenant que nous avons (peut-\u00eatre correctement) identifi\u00e9 le paquet client, il nous faut trouver le paquet serveur pour envoyer la r\u00e9ponse au client. Ici, je vais donner imm\u00e9diatement la valeur de l\u0027Opcode sans d\u00e9voiler la fa\u00e7on de le trouver. Les opcodes serveur sont effectivement plus complexes \u00e0 trouver que les opcodes client et les fa\u00e7ons de les identifier d\u00e9passent le cadre de ce guide, tout en \u00e9tant trop critiques pour \u00eatre d\u00e9voil\u00e9es pour l\u0027instant. Il s\u0027agit donc de l\u0027Opcode 4433 (0x1151 en h\u00e9xad\u00e9cimal).\u003C\/p\u003E\n\n\u003Cp\u003E[Image: 141223063635550229.jpg]\u003C\/p\u003E\n\n\u003Cp\u003EL\u0027ensemble des paquets serveurs passent par la m\u00eame fonction appel\u00e9e le ProcessMessage que vous pouvez trouver ici :\u003C\/p\u003E\n\u003Cpre\u003E\u003Ccode\u003E\n\nvoid __thiscall NetClient__ProcessMessage(void *this, int a2, unsigned int a3, int a4)\n{\n  int v4; \/\/ ebx@1                                                            \n  void *v5; \/\/ edi@1                                                          \n  unsigned int v6; \/\/ esi@1                                                   \n  unsigned int v7; \/\/ eax@7                                                   \n  unsigned int v8; \/\/ eax@11                                                  \n  int v9; \/\/ ecx@12                                                           \n\n  ++dword_10A0E64;\n  v4 = a3;\n  v5 = this;\n  CDataStore__GetInt32(a3, (int)\u0026amp;a3);\n  v6 = a3;\n  if ( a3 \u0026amp; 0x80A )\n  {\n    if ( (a3 \u0026amp; 0xA58) == 2120 )\n    {\n      sub_7221C0(v5, 0, a2, a3, v4);\n    }\n    else\n    {\n      if ( (a3 \u0026amp; 0x248) == 520 )\n      {\n        JAM_ProcessMovement(v5, 0, a2, a3, v4);\n      }\n      else\n      {\n        v7 = a3 \u0026amp; 0x90A;\n        if ( v7 == 2304 )\n        {\n          JAM_ProcessQuest(v5, 0, a2, a3, v4);\n        }\n        else\n        {\n          if ( v7 == 2048 )\n          {\n            JAM_ProcessSpell(v5, 0, a2, a3, v4);\n          }\n          else\n          {\n            (*(void (__thiscall **)(void *, unsigned int))(*(_DWORD *)v5 + 68))(v5, a3);\n            v8 = v6 \u0026amp; 1 | ((v6 \u0026amp; 4 | ((v6 \u0026amp; 0x30 | (v6 \u0026gt;\u0026gt; 1) \u0026amp; 0x7FC0) \u0026gt;\u0026gt; 1)) \u0026gt;\u0026gt; 1);\n            if ( (v6 \u0026amp; 0x4A) == 2 \u0026amp;\u0026amp; (v9 = *((_DWORD *)v5 + v8 + 340)) != 0 )\n              ((void (__cdecl *)(_DWORD, unsigned int, int, int))(v9 - ((v6 | (v6 \u0026lt;\u0026lt; 16)) ^ 0x62A3A31D)))(\n                *((_DWORD *)v5 + v8 + 2388),\n                v6,\n                a2,\n                v4);\n            else\n              (*(void (__thiscall **)(int))(*(_DWORD *)v4 + 24))(v4);\n          }\n        }\n      }\n    }\n  }\n  else\n  {\n    JAM_ClientDispatch(0, a2, a3, v4);\n  }\n}\u003C\/code\u003E\u003Cscript async=\u0022\u0022 crossorigin=\u0022anonymous\u0022 data-hljs-style=\u0022github-gist\u0022 integrity=\u0022sha384-eud4nQrKZMwcYak7or3J5ZPJx1x4HRe8iTTHJy1SUVrDD+fP30Bo\/F8OSdQJpk8d\u0022 onload=\u0022hljsLoader.highlightBlocks(this.parentNode)\u0022 src=\u0022https:\/\/cdn.jsdelivr.net\/gh\/s9e\/hljs-loader@1.0.18\/loader.min.js\u0022\u003E\u003C\/script\u003E\u003C\/pre\u003E\n\u003Cp\u003ECette fonction effectue diff\u00e9rents calculs sur l\u0027opcode afin de le rediriger vers diff\u00e9rentes fonctions charg\u00e9es de traiter chaque paquet.\u003C\/p\u003E\n\n\u003Cp\u003E[Image: 141223063636716227.jpg]\u003C\/p\u003E\n\n\u003Cp\u003EAfin de trouver la sub (le handler) correspondante au paquet serveur, nous utilisons notre logiciel OpcodeTool afin de calculer diff\u00e9rentes valeurs que nous appelons Offsets. Cela nous am\u00e8ne \u00e0 une fonction contenant un switch. Dans ce switch, nous retrouvons l\u0027Offset trouv\u00e9, qui nous indique directement la fonction appel\u00e9e.\u003C\/p\u003E\n\n\u003Cp\u003E[Image: 141223063636106990.jpg] [Image: 141223063635874786.jpg]\u003C\/p\u003E\n\n\u003Cp\u003EUne fois la sub identifi\u00e9e, nous arrivons \u00e0 la sub principale qui initialise quelques donn\u00e9es. Cette fonction ne nous int\u00e9resse pas, nous poursuivons notre chemin vers la sub suivante indiqu\u00e9e en rouge sur l\u0027image.\u003C\/p\u003E\n\n\u003Cp\u003E[Image: 141223063636229429.jpg]\u003C\/p\u003E\n\n\u003Cp\u003ENous arrivons enfin au handler g\u00e9rant le paquet SMSG_WHO. Son code se trouve ici :\u003C\/p\u003E \n\u003Cpre\u003E\u003Ccode\u003E\n\nint __thiscall sub_7DE9E0(void *this, int a2, int a3)\n{\n  int result; \/\/ eax@1                                                                \n  int v4; \/\/ ebx@1                                                                    \n  unsigned int v5; \/\/ edi@1                                                           \n  void *v6; \/\/ esi@1                                                                  \n  int v7; \/\/ edx@1                                                                    \n  unsigned int v8; \/\/ ecx@3                                                           \n  int v9; \/\/ ecx@6                                                                    \n  int v10; \/\/ edi@9                                                                   \n  int v11; \/\/ eax@10                                                                  \n  int v12; \/\/ ecx@10                                                                  \n  int v13; \/\/ edx@10                                                                  \n  int v14; \/\/ edi@11                                                                  \n  int v15; \/\/ edx@12                                                                  \n  int v16; \/\/ edx@12                                                                  \n  int v17; \/\/ [sp+Ch] [bp-10h]@1                                                      \n  __int16 v18; \/\/ [sp+10h] [bp-Ch]@1                                                  \n  int v19; \/\/ [sp+14h] [bp-8h]@10                                                     \n  int v20; \/\/ [sp+18h] [bp-4h]@1                                                      \n\n  v4 = a2;\n  v6 = this;\n  v20 = 0;\n  CDataStore__GetInt32(a2, (int)\u0026amp;v20);\n  LOBYTE(a2) = 0;\n  v7 = a2;\n  *((_DWORD *)v6 + 8) = v20;\n  v17 = v4;\n  v18 = 2048;\n  result = sub_733B60(\u0026amp;v17, v7);\n  v5 = result;\n  if ( (unsigned int)result \u0026gt; *((_DWORD *)v6 + 4) )\n  {\n    if ( (unsigned int)result \u0026gt; *((_DWORD *)v6 + 6) )\n    {\n      v8 = *((_DWORD *)v6 + 7);\n      if ( !v8 )\n        v8 = sub_75E730(result);\n      if ( v5 % v8 )\n        v9 = v5 + v8 - v5 % v8;\n      else\n        v9 = v5;\n      result = sub_7B1820(v9);\n    }\n  }\n  *((_DWORD *)v6 + 4) = v5;\n  v10 = 0;\n  a2 = 0;\n  if ( *((_DWORD *)v6 + 4) )\n  {\n    do\n    {\n      LOBYTE(v20) = 0;\n      v11 = sub_70A730(v20);\n      v12 = *((_DWORD *)v6 + 5);\n      LOBYTE(v19) = 0;\n      v13 = v19;\n      *(_DWORD *)(v10 + v12) = v11;\n      *(_DWORD *)(v10 + *((_DWORD *)v6 + 5) + 48) = CDataStore__Read7Bits((int)\u0026amp;v17, v13);\n      result = a2 + 1;\n      v10 += 164;\n      a2 = result;\n    }\n    while ( (unsigned int)result \u0026lt; *((_DWORD *)v6 + 4) );\n  }\n  v14 = 0;\n  v20 = 0;\n  if ( *((_DWORD *)v6 + 4) )\n  {\n    do\n    {\n      v15 = *((_DWORD *)v6 + 5);\n      a2 = *(_DWORD *)(v14 + v15 + 48);\n      CDataStore__ReadStringWithSize(v4, (void *)(v14 + v15 + 48), a2);\n      *(_BYTE *)(v14 + *((_DWORD *)v6 + 5) + a2 + 48) = 0;\n      v16 = *((_DWORD *)v6 + 5);\n      a2 = *(_DWORD *)(v14 + v16);\n      CDataStore__ReadStringWithSize(v4, (void *)(v14 + v16), a2);\n      *(_BYTE *)(v14 + *((_DWORD *)v6 + 5) + a2) = 0;\n      a2 = 0;\n      CDataStore__GetInt32(v4, (int)\u0026amp;a2);\n      *(_DWORD *)(v14 + *((_DWORD *)v6 + 5) + 148) = a2;\n      a2 = 0;\n      CDataStore__GetInt32(v4, (int)\u0026amp;a2);\n      *(_DWORD *)(v14 + *((_DWORD *)v6 + 5) + 152) = a2;\n      BYTE3(a2) = 0;\n      CDataStore__GetInt8(v4, (int)((char *)\u0026amp;a2 + 3));\n      *(_BYTE *)(v14 + *((_DWORD *)v6 + 5) + 156) = BYTE3(a2);\n      a2 = 0;\n      CDataStore__GetInt32(v4, (int)\u0026amp;a2);\n      *(_DWORD *)(v14 + *((_DWORD *)v6 + 5) + 144) = a2;\n      a2 = 0;\n      CDataStore__GetInt32(v4, (int)\u0026amp;a2);\n      *(_DWORD *)(v14 + *((_DWORD *)v6 + 5) + 160) = a2;\n      result = v20 + 1;\n      v14 += 164;\n      v20 = result;\n    }\n    while ( (unsigned int)result \u0026lt; *((_DWORD *)v6 + 4) );\n  }\n  return result;\n}\u003C\/code\u003E\u003Cscript async=\u0022\u0022 crossorigin=\u0022anonymous\u0022 data-hljs-style=\u0022github-gist\u0022 integrity=\u0022sha384-eud4nQrKZMwcYak7or3J5ZPJx1x4HRe8iTTHJy1SUVrDD+fP30Bo\/F8OSdQJpk8d\u0022 onload=\u0022hljsLoader.highlightBlocks(this.parentNode)\u0022 src=\u0022https:\/\/cdn.jsdelivr.net\/gh\/s9e\/hljs-loader@1.0.18\/loader.min.js\u0022\u003E\u003C\/script\u003E\u003C\/pre\u003E\n\n\u003Cp\u003E[Image: 141223063636817258.jpg]\u003C\/p\u003E\n\n\u003Cp\u003EA cette \u00e9tape, le travail est identique au CMSG. Il nous faut dans un premier temps identifier la structure, chose faite en une dizaine de minutes.\u003C\/p\u003E\n\n\u003Cp\u003E[Image: 141223063636356255.jpg]\u003C\/p\u003E\n\n\u003Cp\u003EUne fois la structure identifi\u00e9e, il faut identifier les donn\u00e9es \u00e0 ins\u00e9rer. Cela se fait \u00e0 nouveau en une trentaine de minutes avec la pratique. A ce stade, nous avons termin\u00e9 le travail de reversing.\u003C\/p\u003E\n\n\u003Cp\u003E[Image: 141223063637109023.jpg]\u003C\/p\u003E\n\n\u003Cp\u003ESi le travail a \u00e9t\u00e9 fait correctement, il ne reste plus qu\u0027\u00e0 profiter du r\u00e9sultat et \u00e0 admirer une belle liste des personnages connect\u00e9s, ici Teraah et moi-m\u00eame pour l\u0027exemple. Voil\u00e0 le fruit d\u0027un peu moins de deux heures de travail pour g\u00e9rer la fonctionnalit\u00e9 du \/WHO.\u003C\/p\u003E\n\n\u003Cp\u003E[Image: 141223063636872671.jpg]\u003C\/p\u003E\n\n\n\u003Ch2\u003E8) G\u00e9n\u00e9ralisation du reversing \u00e0 l\u0027ensemble des paquets\u003C\/h2\u003E\n\n\u003Cp\u003EMaintenant que vous avez conscience du travail effectu\u00e9 pour corriger une fonctionnalit\u00e9 simple telle que le \/WHO, il est de mon devoir de rappeler la totalit\u00e9 du travail \u00e0 accomplir. Premi\u00e8rement, il existe environ 2500 paquets \u00e0 corriger. Nous en avons vu 2 ensemble au travers de ce guide. Ensuite, il s\u0027agit d\u0027un syst\u00e8me assez simple. Le fait que ce soit un paquet tr\u00e8s visuel (on clique sur un bouton, le paquet est envoy\u00e9. On envoie le message, le paquet est re\u00e7u) nous permet de tester tr\u00e8s facilement les diff\u00e9rentes valeurs envoy\u00e9s. Cela raccourcit grandement les \u00e9tapes d\u0027identification des variables qui prennent tout de m\u00eame 30 minutes avec cette facilit\u00e9. Je vous laisse imaginer ce qui arrive lorsque les paquets sont des paquets \u0022invisibles\u0022 tels que tous les paquets envoy\u00e9s avant l\u0027acc\u00e8s au jeu (connexion au serveur) ou encore les syst\u00e8mes n\u00e9cessitant plusieurs envois\/r\u00e9ceptions de messages (le syst\u00e8me de qu\u00eates par exemple n\u00e9cessite pr\u00e8s de 10 paquets diff\u00e9rents pour afficher la qu\u00eate dans son journal). Ensuite, les handlers de ces deux paquets sont relativement cours, avec moins de 200 lignes environ. Il faut savoir que les handlers de certains paquets de qu\u00eates, de d\u00e9placement, ou de spells, font plus de 3000 lignes. Vous comprendrez que le risque d\u0027erreur est tr\u00e8s grand et qu\u0027il arrive souvent de devoir relire plusieurs fois le handler pour ne louper aucune variable. Enfin, il s\u0027agissait ici de variables plut\u00f4t simples \u00e0 trouver, car l\u0027ancien syst\u00e8me de \/who (des version Cataclysm) \u00e9tait semblable \u00e0 celui-ci. Imaginez le travail lorsqu\u0027il s\u0027agit de paquets totalement inconnus, tels que le syst\u00e8me de bataille de Pets par exemple.\u003C\/p\u003E\n\n\u003Cp\u003EMalgr\u00e9 la complexit\u00e9 et le c\u00f4t\u00e9 fastidieux du reversing, sachez que c\u0027est vraiment la partie la plus plaisante du travail car c\u0027est \u00e0 ce moment qu\u0027on apprend le plus. On comprend comment fonctionne le jeu, mais \u00e9galement l\u0027ordinateur, la m\u00e9moire, et tout ce qui fait tourner un tel syst\u00e8me. En comprenant ce syst\u00e8me, vous \u00eates rompus \u00e0 toutes les situations de d\u00e9veloppement et c\u0027est un pur bonheur que de r\u00e9ussir \u00e0 passer outre la complexit\u00e9 pour que le client affiche ce que vous souhaitez.\u003C\/p\u003E\n\n\u003Cp\u003EC\u0027est ici que s\u0027ach\u00e8ve ce guide plut\u00f4t long. Comme d\u0027habitude, j\u0027esp\u00e8re obtenir de nombreuses remarques constructives afin d\u0027am\u00e9liorer les points sensibles et de faire en sorte que ce guide soit accessible au moins chevronn\u00e9 des d\u00e9veloppeurs.\u003C\/p\u003E\n\n\u003Cp\u003EMerci de m\u0027avoir lu jusqu\u0027au bout.\u003C\/p\u003E ","editedAt":"2021-01-09T15:40:22+00:00","canEdit":false,"canDelete":false,"canHide":false,"isApproved":true,"canApprove":false,"canFlag":false,"canLike":false},"relationships":{"discussion":{"data":{"type":"discussions","id":"38"}},"user":{"data":{"type":"users","id":"1"}},"editedUser":{"data":{"type":"users","id":"1"}},"likes":{"data":[{"type":"users","id":"3"}]},"mentionedBy":{"data":[]}}},{"type":"users","id":"1","attributes":{"username":"Galathil","displayName":"Galathil","avatarUrl":"https:\/\/forum.open-wow.eu\/assets\/avatars\/6zjneQm6RzYl44hc.png","slug":"Galathil","joinTime":null,"discussionCount":34,"commentCount":37,"canEdit":false,"canDelete":false,"lastSeenAt":"2021-03-10T08:52:22+00:00","canSuspend":false},"relationships":{"groups":{"data":[{"type":"groups","id":"1"},{"type":"groups","id":"4"}]}}},{"type":"users","id":"3","attributes":{"username":"kazuma","displayName":"kazuma","avatarUrl":"https:\/\/forum.open-wow.eu\/assets\/avatars\/AYcrY5sSfEtjPbUU.png","slug":"kazuma","joinTime":null}},{"type":"groups","id":"1","attributes":{"nameSingular":"Administrateur","namePlural":"Administrateurs","color":"#B72A2A","icon":"fas fa-wrench","isHidden":0}},{"type":"groups","id":"4","attributes":{"nameSingular":"Mod\u00e9rateur","namePlural":"Mod\u00e9rateurs","color":"#80349E","icon":"fas fa-bolt","isHidden":0}},{"type":"tags","id":"2","attributes":{"name":"Tutoriels","description":"","slug":"tutoriels","color":"#e74c3c","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":74,"position":2,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-03-12T17:42:30+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":56}}]}});
                flarum.core.app.bootExtensions(flarum.extensions);
                flarum.core.app.boot();
            } catch (e) {
                var error = document.getElementById('flarum-loading-error');
                error.innerHTML += document.getElementById('flarum-content').textContent;
                error.style.display = 'block';
                throw e;
            }
        </script>
</body>
</html>
