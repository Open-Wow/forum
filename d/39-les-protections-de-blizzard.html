<!doctype html>
<html dir="ltr" lang="fr">
<head>
<meta charset="utf-8">
<title>Les protections de Blizzard - Open WoW</title>
<link rel="stylesheet" href="../assets/forum-b586aac9.css">
<link rel="canonical" href="39-les-protections-de-blizzard.html">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1">
<meta name="description" content="Le forum francophone d&#039;√©mulation WoW.">
<meta name="theme-color" content="#4D698E">
<link rel="shortcut icon" href="../assets/favicon-19klahq3.png">
<script src="https://www.recaptcha.net/recaptcha/api.js?hl=fr&render=explicit" async defer></script>
</head>
<body>
<div id="app" class="App">
<div id="app-navigation" class="App-navigation"></div>
<div id="drawer" class="App-drawer">
<header id="header" class="App-header">
<div id="header-navigation" class="Header-navigation"></div>
<div class="container">
<h1 class="Header-title">
<a href="https://forum.open-wow.eu" id="home-link">
<img src="../assets/logo-fje1vtuv.png" alt="Open WoW" class="Header-logo">
</a>
</h1>
<div id="header-primary" class="Header-primary"></div>
<div id="header-secondary" class="Header-secondary"></div>
</div>
</header>
</div>
<main class="App-content">
<div id="content"></div>
<div id="flarum-loading" style="display: none">
Chargement‚Ä¶
</div>
<noscript>
    <div class="Alert">
        <div class="container">
            Ce site est optimis√© pour √™tre consult√© depuis un navigateur moderne dans lequel JavaScript est activ√©.
        </div>
    </div>
</noscript>
<div id="flarum-loading-error" style="display: none">
<div class="Alert">
<div class="container">
Une erreur est survenue lors de la tentative de chargement de la version compl√®te de ce site. Veuillez purger le cache de votre navigateur et rafra√Æchir cette page pour tenter de corriger cette erreur.
</div>
</div>
</div>
<noscript id="flarum-content">
    <div class="container">
    <h2>Les protections de Blizzard</h2>

    <div>
                    <div>
                                <h3>Galathil</h3>
                <div class="Post-body">
                    <p><strong>Important :</strong> Ce tutoriel a √©t√© r√©dig√© par Nobodie pour le site wow-emu.fr. Je le recopie ici √† l'identique, Il se peut que certaines informations soient obsol√®tes √† ce jour. Bonne lecture !</p>

<h1>Les protections de Blizzard</h1>
<p><strong>Pr√©lude : Ce sujet n'est pas original, il a √©t√© transf√©r√© d'un pr√©c√©dent forum d'√©mulation en date d'Octobre 2013. J'en suis l'auteur, je le transf√®re donc pour les besoins de ce forum. Bien qu'il soit en partie r√©-√©crit, il se peut que certains termes soient inadapt√©s ou ne soient plus d'actualit√©.</strong></p>

<p>Bonjour √† tous,</p>

<p>aujourd'hui nous allons parler des protections mises en place par nos chers amis de Blizzard √† l'encontre des serveurs priv√©s. Il est aujourd'hui tr√®s difficile de d√©velopper un serveur sous MoP, mais √ßa n'a pas toujours √©t√© le cas. Petit flashback dans le lointain pass√© des versions magiques 1.X, 2.X etc. Mais d'abord, un petit point sur les √©l√©ments qui ont chang√©.</p>

<p>Avant de faire le point sur les diff√©rentes √©volutions et complexifications du syst√®me, nous allons rapidement r√©fl√©chir sur les "leviers" sur lesquels Blizzard peut jouer pour mettre des b√¢tons dans les roues des serveurs de jeu. Si vous avez lu mon pr√©c√©dent guide sur le fonctionnement g√©n√©ral d'un serveur de jeu, vous avez vu qu'il existe plusieurs points critiques. Blizzard peut donc jouer par exemple sur le contenu, en cr√©ant du contenu de plus en plus difficile √† impl√©menter. C'est tout √† fait faisable, mais techniquement, le but du contenu est de faire plaisir au joueur. Complexifier le contenu au d√©triment du plaisir du joueur, c'est un peu se tirer une balle dans le pied. Il pourrait √©galement changer les syst√®mes de jeu (par exemple, changer en profondeur le syst√®me de d√©gats pour faire des d√©g√¢ts de zone √† la mani√®re de Rift et non plus le syst√®me de ciblage comme on le connait. Malheureusement, √ßa aussi, √ßa touche √† la politique m√™me du jeu. Non, pour enquiquiner le plus possible les d√©veloppeurs de serveurs wow, il faut trouver quelque chose de bien plus machiav√©lique üòÄ Heureusement, il existe une solution qui regroupe tous ces points :</p>
 <ul><li>Ind√©pendant du gameplay du jeu</li>
 <li>Impossible √† contourner (pour que les serveurs priv√©s soient oblig√©s de s'y conformer)</li>
 <li>Peu co√ªteux</li>
 <li>Invisible pour les joueurs (comme √ßa en plus les joueurs du priv√© ne voient pas que les d√©veloppeurs font un gros travail ! Quand je vous disais que c'√©tait machiav√©lique üòâ)</li></ul>

<p>Il existe un seul syst√®me qui regroupe tous ces points sur lequel Blizzard peut tout g√©rer : il s'agit de la couche R√©seau ! Tout le protocole de communication Client&lt;-&gt;Serveur. Il est :</p>

 <ul><li><strong>Ind√©pendant du gameplay du jeu :</strong> C'est la couche la plus basse du jeu. Peu importe le syst√®me qui se trouve au dessus, les donn√©es sont envoy√©es.</li>
 <li><strong>Impossible √† contourner :</strong> C'est un syst√®me tr√®s sensible. Si le client attend de recevoir un message contenant l'id du joueur, son level, ses spells et un pain au chocolat, alors le client doit recevoir l'id du joueur, son level, ses spells et un pain au chocolat. Si il y a une erreur, vous obtenez a coup s√ªr soit un crash client, soit un comportement ingame tout √† fait mortel. Et impossible de contourner ce syst√®me pour le serveur, il est tellement imbriqu√© dans le client que tenter de cracker le syst√®me revient √† recoder tout cela .... en assembleur üòÄ bonne chance √† vous üòâ</li>
 <li><strong>Peu co√ªteux :</strong> Techniquement, √ßa ne co√ªte rien d'inverser des valeurs √† chaque mise √† jour. Il suffit que le serveur officiel fasse cette inversion √©galement. Facile lorsque Blizzard poss√®de les sources de son propre jeu. Sans avoir les sources, cela devient beaaaaaucoup plus complexe.</li>
 <li><strong>Invisible pour les joueurs :</strong> Qui s'est d√©j√† rendu compte que derri√®re un jeu tel que Wow, vous envoyiez l'√©quivalent de 100 gros SMS chaque seconde ? Pas moi, avant de me confronter √† cette horreur.</li></ul>

<p>La couche R√©seau est donc le fier gagnant, et depuis les d√©buts de Wow, Blizzard "s'amuse" √† notre grand regret, √† obfusquer un peu plus chaque version. Les paquets envoy√©s se sont donc petit √† petit allong√©s et complexifi√©s, comme nous allons le voir sous peu.</p>

<p>Dernier petit rappel pr√©liminaire : Le contenu d'un paquet "type".</p>

<p>Imaginons un paquet type simplifi√©. Ce paquet est un paquet utilis√© √† la fois du c√¥t√© client, comme du c√¥t√© serveur (sa structure est la m√™me des deux c√¥t√©s). Il contient les informations suivantes :</p>
 <ul><li>Un Opcode sur 2 octets : C'est l'identifiant pur du paquet. Il sert √† identifier le paquet pour savoir quoi en faire (par exemple, imaginons l'opcode 100 qui est charg√© d'envoyer des infos sur un joueur)</li>
 <li>Un Guid sur 8 octets : C'est l'identifiant du joueur pour lequel on envoie ces informations.</li>
 <li>Un float (un chiffre √† virgule) sur 4 octets : la hauteur du joueur par rapport au sol. Cette information permet de savoir si le joueur est en train de voler.</li>
 <li>Une cha√Æne de caract√®res sur X octets : C'est le nom du joueur. Comme on ne sait pas d'avance quelle taille fait cette cha√Æne, on utilise un caract√®re sp√©cial en fin de cha√Æne pour signifier qu'on vient de terminer la lecture (si on veut √©crire NoboDie, on √©crit le pseudo suivi d'un caract√®re 0x00, un caract√®re NULL d√©limitant la fin de la cha√Æne)</li>
 <li>Un compteur sur 1 octet : ce compteur va nous indiquer le nombre d'√©l√©ments qui vont √™tre envoy√©s dans la boucle suivante.</li>
 <li>Une boucle qui envoie une variable sur 4 octets : Un Id de spell. Imaginons que le joueur ai appris 4 sorts. Le compteur pr√©c√©dent vaudra 4, et la boucle remplira le paquet avec 4 IDs de spells les uns apr√®s les autres.</li></ul>

<p>Ceci est un paquet tr√®s simple qui n'est l√† que pour l'exemple. Evidemment, le syst√®me envoie une multitude de paquets diff√©rents et atrement plus complexes que celui-ci, mais il faut bien un d√©but √† tout et ce paquet "type" regroupe diff√©rents types de variables que l'ont est amen√©s √† rencontrer sur wow.</p>

<p>Dernier point sur la fa√ßon la plus simple dont un paquet peut √™tre trait√© (en fait, comme √ßa a √©t√© fait au d√©but). Le syst√®me le plus simple est d'avoir un tableau du type tableau[opcode] = fonctionquiremplitlepaquet();</p>

<p>C'est assez intuitif : on associe √† chaque opcode (qui, je le rappelle, est l'identifiant du paquet et sert √† savoir de quoi il va parler), la fonction qui le traite (dans le cas ou le message arrive vers le client) ou la fonction qui le remplit (dans le cas ou le message part du client). Nous verrons que cela s'est √©videmment complexifi√© au fil des ann√©es üòâ</p>

<p>Bien, maintenant que nous avons d√©fini un paquet (fictif, je le rappelle) et la fa√ßon la plus simple de le traiter, voyons comment celui-ci a pu √™tre g√©r√© au fil des versions (je ne complexifie pas les choses, c'est r√©ellement le fonctionnement du syst√®me)</p>

<h2>1. Le bonheur de Wow Vanilla</h2>

<p>Ok, on commence doucement, Blizzard vient de sortir son premier MMOrpg, il faudrait pas qu'ils ne se plantent et que leur jeu ait des soucis. Afin de simplifier l'explication, je ne traiterais ici que l'envoi et la r√©ception de variables de type UINT64, cad en g√©n√©ral un Guid (de joueur, de cr√©ature, d'item, ...) :</p>

<pre><code class="language-cpp">int64 guid;
packet &lt;&lt; guid;</code><script async="" crossorigin="anonymous" data-hljs-style="github-gist" integrity="sha384-eud4nQrKZMwcYak7or3J5ZPJx1x4HRe8iTTHJy1SUVrDD+fP30Bo/F8OSdQJpk8d" onload="hljsLoader.highlightBlocks(this.parentNode)" src="https://cdn.jsdelivr.net/gh/s9e/hljs-loader@1.0.18/loader.min.js"></script></pre>

<p>Comme vous pouvez vous rendre compte, le syst√®me est tr√®s simple. Aujourd'hui, 100% des paquets de la 1.X sont connus. Encore heureux me direz-vous, √ßa fait 10 ans qu'elle existe ^^. Aucune modification sur le protocole de communication n'a √©t√© faite sur l'ensemble de la p√©riode 1.X (Wow Vanilla). Les serveurs Vanilla pouvaient donc vivre tranquilles. Il y avait seulement une centaine de paquets diff√©rents.</p>

<h2>2. Wow Burning Crusade, √ßa commence ..</h2>

<p>Arriv√©e de la nouvelle extension. Surprise, avec les nouveaut√©s du gameplay, pr√®s de 200 nouveaux opcodes (et donc paquets) apparaissent, ce qui multiplie par 3 le travail. Heureusement, les 100 premiers paquets ne changent pas d'identifiant, il est donc facile d'avoir une version √† peu pr√®s aussi fonctionnelle que la version 1.X Vanilla. Autre nouveaut√©, certains paquets ne sont utilis√©s que dans un sens (du serveur vers le client par exemple). Ca ne pose pas gros probl√®me, les opcodes sont toujours enregistr√©s dans un tableau avec leur handler associ√©. Presque du bonheur, j'vous dit üòÄ.Toujours aucun changement d'une sous version √† une autre, en dehors de nouveaux opcodes pour les nouvelles fonctionnalit√©s. On passe √† la suite.</p>

<ol style="list-style-type:decimal" start="3"><li>Wow Wrath Of The Lich King, A√Øe ...</li></ol>

<p>Et voil√†, √ßa devait arriver. Evidemment, √ßa devenait trop simple de trouver les opcodes directement dans le tableau de handlers. Les opcodes sont maintenant de trois types : les opcodes d'authentification (les authOpcodes), les opcodes de type JAM (les jamOpcodes) et les opcodes de type table (les tableOpcodes). Ces derniers sont toujours enregistr√©s via un tableau, mais il faut maintenant faire un calcul sur l'opcode. L'opcode n'est plus enregistr√© en dur, il faut donc jouer et sniffer les paquets pour trouver les correspondances. Ca devient long en temps de calcul. Par contre, les opcodes sont toujours les m√™mes depuis la premi√®re extension, on peut encore retrouver des choses. Ouf !</p>

<p>Oh et puis tiens, on va plus simplement envoyer les GUIDs tels qu'ils sont, c'est √† dire un uint64 (8 octets). On va maintenant faire un packedGUID. C'est la m√™me chose, mais on va mettre en place un algorithme pour rapetisser le guid comme √ßa non seulement il ne prendra plus 8 octets en taille, mais en plus il sera plus compliqu√© √† d√©chiffrer pour les d√©veloppeurs du priv√©. Niark, Evil inside x)</p>

<p>En revanche, il "suffit" de comprendre le syst√®me une seule fois, puisqu'ensuite c'est la m√™me fonction qui est appel√©e √† chaque fois.</p>
<pre><code class="language-cpp">int64 appendPackedGuid(int64 guid) {
uint8 packGUID[8+1];
packGUID[0] = 0;
size_t size = 1;
for (uint8 i = 0;guid != 0;++i) {
if (guid &amp; 0xFF) {
packGUID[0] |= uint8(1 &lt;&lt; i);
packGUID[size] = uint8(guid &amp; 0xFF);
++size;
}
guid &gt;&gt;= 8;
}
append(packGUID, size);
}

int64 guid;
packet.appendPackedGuid(guid);</code><script async="" crossorigin="anonymous" data-hljs-style="github-gist" integrity="sha384-eud4nQrKZMwcYak7or3J5ZPJx1x4HRe8iTTHJy1SUVrDD+fP30Bo/F8OSdQJpk8d" onload="hljsLoader.highlightBlocks(this.parentNode)" src="https://cdn.jsdelivr.net/gh/s9e/hljs-loader@1.0.18/loader.min.js"></script></pre>

<p>Vous avez l'impression que √ßa se complique ? c'est bien, vous n'avez encore rien vu ...</p>

<h2>4. Wow Cataclysm, La revanche du Retour du Jedi ...</h2>

<p>Bon aller maintenant √ßa suffit, on en a marre des serveurs priv√©s ! Oh punaise ils vont en baver l√† ! On va leur implanter ... des Opcodes al√©atoires ! Waouw grande id√©e ! Ca revient √† quoi ? et bien, √† chaque sous version (4.0.6, 4.1.0, 4.1.0a, 4.1.3, ...) on va changer al√©atoirement tous les Opcodes ! Hop hop hop ! Oh et puis tant qu'√† faire, on va inverser les structures de chaque paquet ! Ca se traduit par plusieures choses pour les serveurs priv√©s :</p>

 <ul><li>Plus possible de se baser sur les versions pr√©c√©dentes pour retrouver les handlers, il faut tout refaire de z√©ro !</li>
 <li>Le serveur officiel change d'opcodes chaque version. Si on veut passer √† la version suivante, il faut √† nouveau tout refaire.</li>
 <li>Pour trouver les informations sur Wotlk et identifier les paquets/structures, on utilisait des sniffers. C'est cool les sniffers, sauf que vu que l'officiel change se paquets √† chaque version, √ßa veut dire que les sniffs ne sont valables que le temps d'une version. S'il nous manque les sniffs pour un syst√®me tel que celui des guildes, on perd tout espoir d'ouvrir le syst√®me de guilde dans des temps raisonnables. Biens√ªr, les sniffs ne sont pas indispensables, mais ils simplifient l√©g√®rement le travail. Une fois le serveur officiel pass√© √† une version ult√©rieure, impossible de refaire des sniffs pour la version travaill√©e actuellement. Difficile, n'est-ce pas ? üòÄ Et ce n'est pas tout pour cette version ...</li></ul>

<p>Arriv√©e de la version 4.3.4. Les serveurs priv√©s en 4.0.6 commencent √† pulluler, et √ßa, c'est pas bon pour Blizzard. Alors pour √©viter que des serveurs 4.3.4 n'arrivent trop vite, on va inventer .... Les GUIDs XOR√©s ! MOUAHAHAHAHAHAHAH</p>

<p>Comment √ßa marche ? et bien c'est un nouvel algorithme qui complexifie l'envoi des GUIDs. Basiquement, on envoie un premier octet qui sert de "mode d'emploi" √† la lecture du guid. Chaque bit de l'octet correspond √† un octet du guid (vous me suivez l√† ? x)). Si le bit est √† 1, alors il faudra lire l'octet correspondant. Et puis comme c'st trop simple, on va le XORer avec cette valeur justement comme √ßa on est s√ªrs que c'est bien compliqu√©. Oh et puis comme maintenant on a divis√© le guid en deux (octet "mode d'emploi" et guid √† part), et bien on va envoyer l'octet au d√©but, et puis le guid plus loin. Oh et puis, puisqu'on peut lire chaque octet du guid s√©par√©ment selon le mode d'emploi, on va envoyer d'abord les 2 premiers octets du guid, puis on va envoyer quelques autres variables inutiles, puis les 4 octets suivants du guid. Puis quelques autres variables, puis enfin les deux dernier octets ! ouais, √ßa √ßa va √™tre bien !</p>

<p>Ah au passage, on va aussi cr√©er une nouvelle fa√ßon d'envoyer une chaine de caract√®res. On va envoyer la taille √† part, puis la cha√Æne sans caract√®re de fin (le NULL dont on a parl√© plus haut). Aller avec √ßa, je crois que c'est bon on leur en a fait assez baver ...</p>

<h2>5. Wow Mists Of Pandaria, Pour moi ce sera un bon Random avec une rondelle de citron et des gla√ßons. Oh et apportez de la cr√®me pour la rondelle ... beaucoup de cr√®me ....</h2>

<p>QUoi ?! ils ont sorti un TrinityCore 4.3.4 ? Ok ! Maintenant √ßa va CH#&amp;<sup>ER</sup> !!!</p>

<p>Okkkk donc on prend tous les ajouts de la 4.3.4 (donc les Random Opcodes √† chaque mise √† jour interm√©diaire, ainsi que la nouvelle fa√ßon de XORer un GUID). Et comme c'est devenu trop facile pour eux, on va faire encore pire. Avant, on envoyait le mask dans l'ordre, et le guid dans l'ordre, il √©tait juste √©parpill√© dans tout le code. Et bien maintenant, on va envoyer tout √ßa dans le d√©sordre AHAH ! Et en plus on va faire √ßa √† chaque mise √† jour interm√©diaire ! MUAHAHAHAHAHAHA (vous voyez pourquoi on a besoin de la cr√®me maintenant ?)</p>

<p>Donc √† pr√©sent, et bien on va envoyer le bit 4 du mask, puis le 7, le 3, le 2, le 0, puis on va envoyer 20 autres bits qui servent √† autre chose qui va bien foutre le bordel, puis on va envoyer le bit 1, le bit 6, et le num√©ro compl√©mentaire, le 5 ! Par ici les gagnants du Loto. Oh pardon, vous avez loup√© votre chance ? vous en avez une deuxi√®me avec le GUID : envoyez d'abord l'octet 3 du guid, puis le 2, puis le 7, puis le 1, puis le 0, puis le 6, puis le 5. On non attendez, foutez quelques variables moisies entre tout √ßa, et finissez par l'octet 4 ! Bravo au gagnant de l'√Æle-et-vilaine, il vient de remporter ... ah bah non rien, car il doit faire √ßa pour encore 1500 autres paquets ...</p>

<pre><code class="language-cpp">packet.WriteBit(guid[4]);
packet.WriteBit(guid[3]);
packet.WriteBit(guid[6]);
... 10 autres donn√©es qui n'ont rien √† voir
packet.WriteBit(guid[2]);
packet.WriteBit(guid[5]);
packet.WriteBit(guid[0]);
... puis 3 autres
packet.WriteBit(guid[7]);
... puis une
packet.WriteBit(guid[1]);
... encore deux
packet.WriteByteSeq(guid[2]);
... Un pikachu sauvage appara√Æt ici
packet.WriteByteSeq(guid[0]);
packet.WriteByteSeq(guid[6]);
... J'aime les Kiwis
packet.WriteByteSeq(guid[3]);
packet.WriteByteSeq(guid[4]);
packet.WriteByteSeq(guid[1]);
... Ca sent le br√ªl√© :/
packet.WriteByteSeq(guid[5]);
... Serait-ce la fin des haricots ?
packet.WriteByteSeq(guid[7]);
... OH YEAH ENCORE DES CHOSES MAIS ON A ENFIN FINI D'ENVOYER LE GUID !</code><script async="" crossorigin="anonymous" data-hljs-style="github-gist" integrity="sha384-eud4nQrKZMwcYak7or3J5ZPJx1x4HRe8iTTHJy1SUVrDD+fP30Bo/F8OSdQJpk8d" onload="hljsLoader.highlightBlocks(this.parentNode)" src="https://cdn.jsdelivr.net/gh/s9e/hljs-loader@1.0.18/loader.min.js"></script></pre>

<p>Oh et puis on revient au sujet des Opcodes qui √©taient divis√©s en 3 cat√©gories. Bon c'est trop simple, on va les diviser en 7 et puis on va mettre une formule math√©matique bien pourrave pour bien les emm..... ces d√©veloppeurs de serveurs priv√©s !</p>

<p>Et bien vous savez quoi ? ce n'est pas suffisant ! On l'a fait les amis ! On travaille bel et bien sur cette version et on va en sortir une tr√®s prochainement ! (un peu de pub personnelle n'a jamais fait de mal :3)</p>

<h2>6. (Annexe) Prochaine extension, quelques id√©es pour nous faire suer un peu plus</h2>

<p>Et oui on est comme √ßa nous ! On donne qelques id√©es au cas ou Blizzard serait en manque d'inspiration ! Top 5 des meilleures id√©es :</p>
 <ol style="list-style-type:decimal"><li>On randomize les variables elles m√™mes. Rien de mieux que d'envoyer une variable sur 12 bits m√©lang√©s !</li>
 <li>On pr√©voit plusieurs opcodes pour le m√™me paquet ! Ben oui, si on utilise plusieurs opcodes, √ßa devient gal√®re d'automatiser l'identification des opcodes dans les sniffs !</li>
 <li>On cr√©√©e un paquet qui d√©finit comment on d√©finit le paquet qui va √™tre r√©ellement envoy√© ! Yo dawg, j'ai entendu dire que tu aimais les paquets de paquets de paquets de paquets ...</li>
 <li>On r√©invente tout un nouveau syst√®me de paquet 100% diff√©rent de la version pr√©c√©dente, comme √ßa on est s√ªrs de bien foutre tout le monde dans la merde !</li>
 <li>On sort le code source en version publique et on arr√™te d'emb√™ter les serveurs priv√©s qui amm√®nent du monde sur officiel (ben quoi, j'ai le droit de r√™ver non ? üòü)</li></ol>


<h2>7. Le point sur Warlords of Draenor</h2>

<p>Cette partie est rajout√©e pr√®s d'un an apr√®s l'√©criture des premi√®res parties du tutoriel. Celle-ci fait le point sur ce qui a √©t√© mis en place par Blizzard entre temps pour la sortie de leur prochaine extension</p>

<p>Alors, tout d'abord, il faut savoir qu'au passage de la 5.3, il y a eu un changement tr√®s utile pour les serveurs priv√©s : l'arriv√©e d'un nouveau compilateur chez Blizzard. Et ce compilateur apporte une chose tr√®s int√©ressante : un mauvais support des fonctions inline (ou, du moins, cela n'a pas √©t√© activ√© correctement du c√¥t√© des d√©veloppeurs de Blizzard). Cela a pour effet de rendre le code source client bien plus lisible. Voil√† un exemple :</p>

<p>Ce code c√¥t√© client en 5.1 :</p>
<pre><code class="language-cpp">if ( v11 == 8 )
{
LOBYTE(a2) = 0;
CDataStore__GetInt8(this, (int)&amp;a2);
v10 = a2;
v11 = 0;
}
v17 = (unsigned int)v10 &gt;&gt; 7;
v16 = v11 + 1;
v15 = 2 * v10;
*(_BYTE *)(v12 + *((_DWORD *)v6 + 7) + 7) = v17;
if ( v16 == 8 )
{
LOBYTE(a2) = 0;
CDataStore__GetInt8(this, (int)&amp;a2);
v15 = a2;
v16 = 0;
}
v20 = (unsigned int)v15 &gt;&gt; 7;
v19 = v16 + 1;
v18 = 2 * v15;
*(_BYTE *)(v12 + *((_DWORD *)v6 + 7)) = v20;
if ( v19 == 8 )
{
LOBYTE(a2) = 0;
CDataStore__GetInt8(this, (int)&amp;a2);
v18 = a2;
v19 = 0;
}
v23 = (unsigned int)v18 &gt;&gt; 7;
v22 = v19 + 1;
v21 = 2 * v18;
*(_BYTE *)(v12 + *((_DWORD *)v6 + 7) + 4) = v23;
if ( v22 == 8 )
{
LOBYTE(a2) = 0;
CDataStore__GetInt8(this, (int)&amp;a2);
v21 = a2;
v22 = 0;
}
v26 = (unsigned int)v21 &gt;&gt; 7;
v25 = v22 + 1;
v24 = 2 * v21;
*(_BYTE *)(v12 + *((_DWORD *)v6 + 7) + 90) = v26;
if ( v25 == 8 )
{
LOBYTE(a2) = 0;
CDataStore__GetInt8(this, (int)&amp;a2);
v24 = a2;
v25 = 0;
}</code><script async="" crossorigin="anonymous" data-hljs-style="github-gist" integrity="sha384-eud4nQrKZMwcYak7or3J5ZPJx1x4HRe8iTTHJy1SUVrDD+fP30Bo/F8OSdQJpk8d" onload="hljsLoader.highlightBlocks(this.parentNode)" src="https://cdn.jsdelivr.net/gh/s9e/hljs-loader@1.0.18/loader.min.js"></script></pre>

<p>Devient celui-ci c√¥t√© client en 5.4 :</p>
<pre><code class="language-cpp">*(_BYTE *)(*((_DWORD *)v3 + 5) + v5 + 91) = CDataStore__ReadBit(&amp;v36);
*(_BYTE *)(*((_DWORD *)v3 + 5) + v5 + 104) = CDataStore__ReadBit(&amp;v36) != 0;
*(_BYTE *)(*((_DWORD *)v3 + 5) + v5 + 6) = CDataStore__ReadBit(&amp;v36);
*(_BYTE *)(*((_DWORD *)v3 + 5) + v5 + 89) = CDataStore__ReadBit(&amp;v36);
*(_BYTE *)(*((_DWORD *)v3 + 5) + v5 + 1) = CDataStore__ReadBit(&amp;v36);
*(_BYTE *)(*((_DWORD *)v3 + 5) + v5 + 5) = CDataStore__ReadBit(&amp;v36);
*(_BYTE *)(*((_DWORD *)v3 + 5) + v5 + 94) = CDataStore__ReadBit(&amp;v36);</code><script async="" crossorigin="anonymous" data-hljs-style="github-gist" integrity="sha384-eud4nQrKZMwcYak7or3J5ZPJx1x4HRe8iTTHJy1SUVrDD+fP30Bo/F8OSdQJpk8d" onload="hljsLoader.highlightBlocks(this.parentNode)" src="https://cdn.jsdelivr.net/gh/s9e/hljs-loader@1.0.18/loader.min.js"></script></pre>

<p>Comme vous le constatez, le changement est appr√©ciable et permet d'aller un peu plus vite sur le reversing de paquets contenant des GUIDs de joueur. Il permet √©galement de lire le code de fa√ßon it√©rative plut√¥t que de v√©rifier que certaines optimisations du compilateur n'aient eu lieu (par exemple, lire plusieurs donn√©es du paquet puis les √©crire dans un ordre diff√©rent nous a pos√© un certain nombre de probl√®mes sur la 5.1 √† l'√©poque).</p>

<p>Un autre petit changement que nous avions pr√©vu mais qui n'est pas si probl√©matique au final, est l'utilisation du m√™me opcode pour plusieurs syst√®mes diff√©rents. Sans rentrer dans les d√©tails, l'opcode est tout de m√™me facilement identifiable selon le contexte d'ex√©cution et il n'est finalement pas si probl√©matique.</p>

<p>Un des changements majeurs impr√©vus a √©t√© la modification du syst√®me de fichier g√©rant les ressources du jeu (mod√®les 3D, DBCs, etc). Le syst√®me est pass√© de MoPaQ (les fameux MPQs) √† CASC (voir ICI) ce qui n√©cessite de recoder l'ensemble des logiciels d'extraction (dbc, maps, vmaps et mmaps).</p>

<p>Mais, en dehors de √ßa, le plus gros challenge reste la mise √† jour du protocole d'authentification. Pour faire simple, avant Wotlk il n'y avait qu'un seul protocole appel√© le GruntLogin. Puis, de Wotlk √† MoP, Blizzard a int√©gr√© le protocole BattleNet tout en maintenant le protocole GruntLogin. Jusqu'√† ce jour, tous les serveurs priv√©s tournent donc sur ce protocole et n'utilisent aucunement le protocole BattleNet. A pr√©sent, avec WoD, le GruntLogin n'existe plus et seul le protocole BattleNet est utilisable. Il faut donc reverse l'ensemble du protocole BattleNet bien plus complexe (la DLL de BattleNet est connue pour √™tre une des plus obfusqu√©es)</p>

<p>Quelques sandbox WoD existent d√©j√† sur Internet, mais elles passent habilement l'√©cran de login. En r√©alit√©, ils consid√®rent toute personne qui tente de se connecter comme authentifi√©e √† un seul et unique compte. Cela a l'avantage de pouvoir rapidement annoncer qu'une sandbox est disponible, mais seule 1 personne peut se connecter en m√™me temps et la protection des comptes joueurs est impossible (puisque chacun peut se faire passer pour un autre)</p>

<p>Au final, le protocole BattleNet sera certainement le plus grand d√©fi propos√© √† l'√©mulation mondiale et nuls doutes que cette √©pine saura causer de nombreux probl√®mes √† qui souhaite ouvrir un serveur Warlords of Draenor.</p>


<p>Voil√† qui cl√¥ture ce guide des protections de Blizzard √† l'encontre des serveurs priv√©s. Vous remarquerez dans mes √©crits une once d'√©nervement (oh, si peu :x) mais avec ces explications, j'esp√®re que vous serez un peu plus attentifs √† la complexit√© du syst√®me et aux raisons pour lesquelles tr√®s peu de serveurs ouvrent leurs portes avec la derni√®re version en date. J'esp√®re √©galement que vous comprendrez pourquoi il n'est plus possible de suivre aussi rapidement l'officiel par rapport √† l'√©poque Burning Crusade/Wotlk.</p>

<p>J'esp√®re que ce guide vous aura plu et vous permettra de prendre conscience de la t√¢che colossale qui se cache r√©ellement derri√®re un serveur priv√©, et que ce n'est pas juste une histoire de contenu pur (qui s'av√®re finalement √™tre assez simple compte tenu de la difficult√© principale qu'est le protocole de communication). <del>Comme d'habitude, je reste ouvert √† toutes les remarques et appr√©ciations constructives</del></p>
                </div>
            </div>

            <hr>
            </div>

    
    </div>

</noscript>
<div class="App-composer">
<div class="container">
<div id="composer"></div>
</div>
</div>
</main>
</div>
<div id="modal"></div>
<div id="alerts"></div>
<script>
            document.getElementById('flarum-loading').style.display = 'block';
            var flarum = {extensions: {}};
        </script>
<script src="../assets/forum-2c55cc91.js"></script>
<script src="../assets/forum-fr-b93474b7.js"></script>
<script>
            document.getElementById('flarum-loading').style.display = 'none';

            try {
                flarum.core.app.load({"resources":[{"type":"forums","id":"1","attributes":{"title":"Open WoW","description":"Le forum francophone d\u0027\u00e9mulation WoW.","showLanguageSelector":true,"baseUrl":"https:\/\/forum.open-wow.eu","basePath":"","debug":false,"apiUrl":"https:\/\/forum.open-wow.eu\/api","welcomeTitle":"Bienvene sur Open WoW","welcomeMessage":"Le forum francophone d\u0027\u00e9mulation WoW.","themePrimaryColor":"#4D698E","themeSecondaryColor":"#4D698E","logoUrl":"https:\/\/forum.open-wow.eu\/assets\/logo-fje1vtuv.png","faviconUrl":"https:\/\/forum.open-wow.eu\/assets\/favicon-19klahq3.png","headerHtml":null,"footerHtml":null,"allowSignUp":true,"defaultRoute":"\/all","canViewDiscussions":true,"canStartDiscussion":true,"canViewUserList":false,"canViewFlags":false,"guidelinesUrl":null,"minPrimaryTags":"1","maxPrimaryTags":"1","minSecondaryTags":"0","maxSecondaryTags":"99","canSeeUserDirectoryLink":false,"userDirectoryDefaultSort":"username_az","darkMode":true,"categories.keepTagsNav":false,"categories.fullPageDesktop":false,"categories.compactMobile":false,"categories.parentRemoveIcon":false,"categories.parentRemoveDescription":false,"categories.parentRemoveStats":false,"categories.parentRemoveLastDiscussion":false,"categories.childBareIcon":false,"emojioneAreaEnableSearch":true,"emojioneAreaEnableRecent":true,"emojioneAreaEnableTones":true,"emojioneAreaFiltersPositionBottom":false,"emojioneAreaSearchPositionBottom":false,"emojioneAreaHideFlarumButton":true},"relationships":{"groups":{"data":[{"type":"groups","id":"1"},{"type":"groups","id":"2"},{"type":"groups","id":"3"},{"type":"groups","id":"4"}]},"tags":{"data":[{"type":"tags","id":"1"},{"type":"tags","id":"2"},{"type":"tags","id":"3"},{"type":"tags","id":"9"},{"type":"tags","id":"10"},{"type":"tags","id":"11"},{"type":"tags","id":"12"},{"type":"tags","id":"13"},{"type":"tags","id":"14"},{"type":"tags","id":"15"},{"type":"tags","id":"16"},{"type":"tags","id":"17"},{"type":"tags","id":"18"},{"type":"tags","id":"19"},{"type":"tags","id":"20"},{"type":"tags","id":"21"},{"type":"tags","id":"23"},{"type":"tags","id":"24"},{"type":"tags","id":"25"},{"type":"tags","id":"26"},{"type":"tags","id":"27"},{"type":"tags","id":"28"},{"type":"tags","id":"29"},{"type":"tags","id":"30"},{"type":"tags","id":"31"},{"type":"tags","id":"32"},{"type":"tags","id":"33"},{"type":"tags","id":"34"},{"type":"tags","id":"35"},{"type":"tags","id":"36"},{"type":"tags","id":"37"},{"type":"tags","id":"38"},{"type":"tags","id":"39"},{"type":"tags","id":"40"},{"type":"tags","id":"42"},{"type":"tags","id":"43"}]}}},{"type":"groups","id":"1","attributes":{"nameSingular":"Administrateur","namePlural":"Administrateurs","color":"#B72A2A","icon":"fas fa-wrench","isHidden":0}},{"type":"groups","id":"2","attributes":{"nameSingular":"Invit\u00e9","namePlural":"Invit\u00e9s","color":null,"icon":null,"isHidden":0}},{"type":"groups","id":"3","attributes":{"nameSingular":"Membre","namePlural":"Membres","color":null,"icon":null,"isHidden":0}},{"type":"groups","id":"4","attributes":{"nameSingular":"Mod\u00e9rateur","namePlural":"Mod\u00e9rateurs","color":"#80349E","icon":"fas fa-bolt","isHidden":0}},{"type":"tags","id":"1","attributes":{"name":"General","description":null,"slug":"general","color":"#888","backgroundUrl":null,"backgroundMode":null,"icon":null,"discussionCount":0,"position":0,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":null,"canStartDiscussion":false,"canAddToDiscussion":false,"postCount":0}},{"type":"tags","id":"2","attributes":{"name":"Tutoriels","description":"","slug":"tutoriels","color":"#e74c3c","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":43,"position":2,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-02-18T21:11:18+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":39},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"62"}}}},{"type":"tags","id":"3","attributes":{"name":"Partages","description":"","slug":"partagess","color":"#e74c3c","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":29,"position":3,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-02-12T15:47:42+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":29},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"56"}}}},{"type":"tags","id":"9","attributes":{"name":"Support","description":"","slug":"support","color":"#e74c3c","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":1,"position":4,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-01-04T17:18:38+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":8},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"28"}}}},{"type":"tags","id":"10","attributes":{"name":"C++","description":"","slug":"tuto-cpp","color":"#e74c3c","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":9,"position":1,"defaultSort":null,"isChild":true,"isHidden":false,"lastPostedAt":"2021-02-18T21:08:17+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":6},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"60"}},"parent":{"data":{"type":"tags","id":"2"}}}},{"type":"tags","id":"11","attributes":{"name":"Lua","description":"","slug":"tuto-lua","color":"#e74c3c","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":6,"position":2,"defaultSort":null,"isChild":true,"isHidden":false,"lastPostedAt":"2021-02-18T21:11:18+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":6},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"62"}},"parent":{"data":{"type":"tags","id":"2"}}}},{"type":"tags","id":"12","attributes":{"name":"SQL","description":"","slug":"tuto-sql","color":"#e74c3c","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":3,"position":4,"defaultSort":null,"isChild":true,"isHidden":false,"lastPostedAt":"2021-01-09T16:37:26+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":4},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"43"}},"parent":{"data":{"type":"tags","id":"2"}}}},{"type":"tags","id":"13","attributes":{"name":"Vanilla","description":"","slug":"vanilla","color":"#f39c12","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":12,"position":null,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-01-07T13:34:50+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":13},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"31"}}}},{"type":"tags","id":"14","attributes":{"name":"The Burning Crusade","description":"","slug":"the-burning-crusade","color":"#f39c12","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":13,"position":null,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-02-12T15:47:42+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":14},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"56"}}}},{"type":"tags","id":"15","attributes":{"name":"Wrath of the Lich King","description":"","slug":"wrath-of-the-lich-king","color":"#f39c12","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":24,"position":null,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-02-18T21:04:05+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":27},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"57"}}}},{"type":"tags","id":"16","attributes":{"name":"Cataclysm","description":"","slug":"cataclysm","color":"#f39c12","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":3,"position":null,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-02-12T15:47:42+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":3},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"56"}}}},{"type":"tags","id":"17","attributes":{"name":"Mists of Pandaria","description":"","slug":"mists-of-pandaria","color":"#f39c12","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":2,"position":null,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-02-12T15:47:42+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":2},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"56"}}}},{"type":"tags","id":"18","attributes":{"name":"Warlords of Draenor","description":"","slug":"warlords-of-draenor","color":"#f39c12","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":2,"position":null,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-02-12T15:47:42+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":2},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"56"}}}},{"type":"tags","id":"19","attributes":{"name":"Legion","description":"","slug":"legion","color":"#f39c12","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":2,"position":null,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-02-12T15:47:42+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":2},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"56"}}}},{"type":"tags","id":"20","attributes":{"name":"Battle for Azeroth","description":"","slug":"battle-for-azeroth","color":"#f39c12","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":2,"position":null,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-02-12T15:47:42+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":2},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"56"}}}},{"type":"tags","id":"21","attributes":{"name":"Shadowlands","description":"","slug":"shadowlands","color":"#f39c12","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":3,"position":null,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-02-12T15:47:42+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":3},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"56"}}}},{"type":"tags","id":"23","attributes":{"name":"TrinityCore","description":"","slug":"trinitycore","color":"#9b59b6","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":26,"position":null,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-02-18T21:04:05+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":25},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"57"}}}},{"type":"tags","id":"24","attributes":{"name":"MaNGOS","description":"","slug":"mangos","color":"#9b59b6","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":10,"position":null,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-02-12T15:47:42+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":12},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"56"}}}},{"type":"tags","id":"25","attributes":{"name":"AzerothCore","description":"","slug":"azerothcore","color":"#9b59b6","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":19,"position":null,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-02-12T15:47:42+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":17},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"56"}}}},{"type":"tags","id":"26","attributes":{"name":"Skyfire","description":"","slug":"skyfire","color":"#9b59b6","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":3,"position":null,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-01-05T13:08:13+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":2},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"30"}}}},{"type":"tags","id":"27","attributes":{"name":"Oregoncore","description":"","slug":"oregoncore","color":"#9b59b6","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":7,"position":null,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-01-07T13:34:50+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":10},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"31"}}}},{"type":"tags","id":"28","attributes":{"name":"C++","description":"","slug":"cplusplus","color":"#2e86c1","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":2,"position":null,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-01-09T16:29:34+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":3},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"42"}}}},{"type":"tags","id":"29","attributes":{"name":"SQL","description":"","slug":"sql","color":"#2e86c1","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":9,"position":null,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-01-09T16:29:34+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":9},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"42"}}}},{"type":"tags","id":"30","attributes":{"name":"Lua","description":"","slug":"lua","color":"#2e86c1","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":15,"position":null,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-01-18T11:03:06+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":15},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"52"}}}},{"type":"tags","id":"31","attributes":{"name":"PHP","description":"","slug":"php","color":"#2e86c1","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":0,"position":null,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":null,"canStartDiscussion":false,"canAddToDiscussion":false,"postCount":0}},{"type":"tags","id":"32","attributes":{"name":"C++","description":"","slug":"rel-cpp","color":"#e74c3c","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":1,"position":1,"defaultSort":null,"isChild":true,"isHidden":false,"lastPostedAt":"2021-01-03T18:14:57+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":1},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"26"}},"parent":{"data":{"type":"tags","id":"3"}}}},{"type":"tags","id":"33","attributes":{"name":"Lua","description":"","slug":"rel-lua","color":"#e74c3c","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":11,"position":2,"defaultSort":null,"isChild":true,"isHidden":false,"lastPostedAt":"2021-01-23T20:31:12+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":10},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"54"}},"parent":{"data":{"type":"tags","id":"3"}}}},{"type":"tags","id":"34","attributes":{"name":"SQL","description":"","slug":"rel-sql","color":"#e74c3c","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":6,"position":4,"defaultSort":null,"isChild":true,"isHidden":false,"lastPostedAt":"2021-01-09T19:51:41+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":6},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"50"}},"parent":{"data":{"type":"tags","id":"3"}}}},{"type":"tags","id":"35","attributes":{"name":"GIT","description":"","slug":"git","color":"#2e86c1","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":1,"position":null,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2020-12-31T12:21:21+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":1},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"8"}}}},{"type":"tags","id":"36","attributes":{"name":"windows","description":"","slug":"windows","color":"#27ae60","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":4,"position":null,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-02-18T21:04:05+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":7},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"57"}}}},{"type":"tags","id":"37","attributes":{"name":"Linux","description":"","slug":"linux","color":"#27ae60","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":4,"position":null,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-02-18T21:04:05+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":5},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"57"}}}},{"type":"tags","id":"38","attributes":{"name":"Guides","description":"","slug":"guides","color":"#00FFF7","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":2,"position":1,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-02-13T21:59:45+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":6},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"20"}}}},{"type":"tags","id":"39","attributes":{"name":"Autres","description":"","slug":"tuto-autres","color":"#e74c3c","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":2,"position":0,"defaultSort":null,"isChild":true,"isHidden":false,"lastPostedAt":"2021-02-03T20:18:27+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":2},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"55"}},"parent":{"data":{"type":"tags","id":"2"}}}},{"type":"tags","id":"40","attributes":{"name":"Autres","description":"","slug":"rel-autres","color":"#e74c3c","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":5,"position":0,"defaultSort":null,"isChild":true,"isHidden":false,"lastPostedAt":"2021-01-27T08:52:01+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":6},"relationships":{"lastPostedDiscussion":{"data":{"type":"discussions","id":"53"}},"parent":{"data":{"type":"tags","id":"3"}}}},{"type":"tags","id":"42","attributes":{"name":"Model-changing","description":"","slug":"tuto-model-changing","color":"#e74c3c","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":0,"position":3,"defaultSort":null,"isChild":true,"isHidden":false,"lastPostedAt":null,"canStartDiscussion":false,"canAddToDiscussion":false,"postCount":0},"relationships":{"parent":{"data":{"type":"tags","id":"2"}}}},{"type":"tags","id":"43","attributes":{"name":"Model-Changing","description":"","slug":"rel-model-changing","color":"#e74c3c","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":0,"position":3,"defaultSort":null,"isChild":true,"isHidden":false,"lastPostedAt":null,"canStartDiscussion":false,"canAddToDiscussion":false,"postCount":0},"relationships":{"parent":{"data":{"type":"tags","id":"3"}}}},{"type":"discussions","id":"62","attributes":{"title":"Stocker des informations avec Eluna","slug":"62-stocker-des-informations-avec-eluna","commentCount":1,"participantCount":1,"createdAt":"2021-02-18T21:11:18+00:00","lastPostedAt":"2021-02-18T21:11:18+00:00","lastPostNumber":1,"canReply":false,"canRename":false,"canDelete":false,"canHide":false,"isApproved":true,"isLocked":false,"canLock":false,"isSticky":false,"canSticky":false,"subscription":null,"canTag":false},"relationships":{"lastPostedUser":{"data":{"type":"users","id":"2"}}}},{"type":"discussions","id":"56","attributes":{"title":"WoW Admin Panel Prenium","slug":"56-wow-admin-panel-prenium","commentCount":1,"participantCount":1,"createdAt":"2021-02-12T15:47:42+00:00","lastPostedAt":"2021-02-12T15:47:42+00:00","lastPostNumber":1,"canReply":false,"canRename":false,"canDelete":false,"canHide":false,"isApproved":true,"isLocked":false,"canLock":false,"isSticky":false,"canSticky":false,"subscription":null,"canTag":false},"relationships":{"lastPostedUser":{"data":{"type":"users","id":"19"}}}},{"type":"discussions","id":"28","attributes":{"title":"Comment extraire les Vmaps sur des donjons modifier ?","slug":"28-comment-extraire-les-vmaps-sur-des-donjons-modifier","commentCount":8,"participantCount":4,"createdAt":"2021-01-03T22:30:02+00:00","lastPostedAt":"2021-01-04T19:13:07+00:00","lastPostNumber":8,"canReply":false,"canRename":false,"canDelete":false,"canHide":false,"isApproved":true,"isLocked":false,"canLock":false,"isSticky":false,"canSticky":false,"subscription":null,"canTag":false},"relationships":{"lastPostedUser":{"data":{"type":"users","id":"8"}}}},{"type":"discussions","id":"60","attributes":{"title":"Mini Boss","slug":"60-mini-boss","commentCount":1,"participantCount":1,"createdAt":"2021-02-18T21:08:17+00:00","lastPostedAt":"2021-02-18T21:08:17+00:00","lastPostNumber":1,"canReply":false,"canRename":false,"canDelete":false,"canHide":false,"isApproved":true,"isLocked":false,"canLock":false,"isSticky":false,"canSticky":false,"subscription":null,"canTag":false},"relationships":{"lastPostedUser":{"data":{"type":"users","id":"2"}}}},{"type":"discussions","id":"43","attributes":{"title":"Les tables SQL de Trinity","slug":"43-les-tables-sql-de-trinity","commentCount":1,"participantCount":1,"createdAt":"2021-01-09T16:37:26+00:00","lastPostedAt":"2021-01-09T16:37:26+00:00","lastPostNumber":1,"canReply":false,"canRename":false,"canDelete":false,"canHide":false,"isApproved":true,"isLocked":false,"canLock":false,"isSticky":false,"canSticky":false,"subscription":null,"canTag":false},"relationships":{"lastPostedUser":{"data":{"type":"users","id":"1"}}}},{"type":"discussions","id":"31","attributes":{"title":"LIC - Lua Icons Chat","slug":"31-lic-lua-icons-chat","commentCount":1,"participantCount":1,"createdAt":"2021-01-07T13:34:50+00:00","lastPostedAt":"2021-01-07T13:34:50+00:00","lastPostNumber":1,"canReply":false,"canRename":false,"canDelete":false,"canHide":false,"isApproved":true,"isLocked":false,"canLock":false,"isSticky":false,"canSticky":false,"subscription":null,"canTag":false},"relationships":{"lastPostedUser":{"data":{"type":"users","id":"2"}}}},{"type":"discussions","id":"57","attributes":{"title":"Anti_Farm","slug":"57-anti-farm","commentCount":2,"participantCount":2,"createdAt":"2021-02-18T21:04:05+00:00","lastPostedAt":"2021-02-18T21:08:49+00:00","lastPostNumber":4,"canReply":false,"canRename":false,"canDelete":false,"canHide":false,"isApproved":true,"isLocked":false,"canLock":false,"isSticky":false,"canSticky":false,"subscription":null,"canTag":false},"relationships":{"lastPostedUser":{"data":{"type":"users","id":"13"}}}},{"type":"discussions","id":"30","attributes":{"title":"Modifier la distance de vue","slug":"30-modifier-la-distance-de-vue","commentCount":1,"participantCount":1,"createdAt":"2021-01-05T13:08:13+00:00","lastPostedAt":"2021-01-05T13:08:13+00:00","lastPostNumber":1,"canReply":false,"canRename":false,"canDelete":false,"canHide":false,"isApproved":true,"isLocked":false,"canLock":false,"isSticky":false,"canSticky":false,"subscription":null,"canTag":false},"relationships":{"lastPostedUser":{"data":{"type":"users","id":"2"}}}},{"type":"discussions","id":"42","attributes":{"title":"Les Bitmasks - Fonctionnement et Exemples","slug":"42-les-bitmasks-fonctionnement-et-exemples","commentCount":2,"participantCount":2,"createdAt":"2021-01-09T16:29:34+00:00","lastPostedAt":"2021-02-12T20:57:11+00:00","lastPostNumber":2,"canReply":false,"canRename":false,"canDelete":false,"canHide":false,"isApproved":true,"isLocked":false,"canLock":false,"isSticky":false,"canSticky":false,"subscription":null,"canTag":false},"relationships":{"lastPostedUser":{"data":{"type":"users","id":"13"}}}},{"type":"discussions","id":"52","attributes":{"title":"Texture Coords Calculator","slug":"52-texture-coords-calculator","commentCount":1,"participantCount":1,"createdAt":"2021-01-18T11:03:06+00:00","lastPostedAt":"2021-01-18T11:03:06+00:00","lastPostNumber":1,"canReply":false,"canRename":false,"canDelete":false,"canHide":false,"isApproved":true,"isLocked":false,"canLock":false,"isSticky":false,"canSticky":false,"subscription":null,"canTag":false},"relationships":{"lastPostedUser":{"data":{"type":"users","id":"2"}}}},{"type":"discussions","id":"26","attributes":{"title":"Activer les races alli\u00e9es ","slug":"26-activer-les-races-alliees","commentCount":1,"participantCount":1,"createdAt":"2021-01-03T18:14:57+00:00","lastPostedAt":"2021-01-03T18:14:57+00:00","lastPostNumber":1,"canReply":false,"canRename":false,"canDelete":false,"canHide":false,"isApproved":true,"isLocked":false,"canLock":false,"isSticky":false,"canSticky":false,"subscription":null,"canTag":false},"relationships":{"lastPostedUser":{"data":{"type":"users","id":"1"}}}},{"type":"discussions","id":"54","attributes":{"title":"[AddOn] TrinityAdmin","slug":"54-addon-trinityadmin","commentCount":1,"participantCount":1,"createdAt":"2021-01-23T20:31:12+00:00","lastPostedAt":"2021-01-23T20:31:12+00:00","lastPostNumber":1,"canReply":false,"canRename":false,"canDelete":false,"canHide":false,"isApproved":true,"isLocked":false,"canLock":false,"isSticky":false,"canSticky":false,"subscription":null,"canTag":false},"relationships":{"lastPostedUser":{"data":{"type":"users","id":"15"}}}},{"type":"discussions","id":"50","attributes":{"title":"Gameobject Paramystick","slug":"50-gameobject-paramystick","commentCount":1,"participantCount":1,"createdAt":"2021-01-09T19:51:41+00:00","lastPostedAt":"2021-01-09T19:51:41+00:00","lastPostNumber":1,"canReply":false,"canRename":false,"canDelete":false,"canHide":false,"isApproved":true,"isLocked":false,"canLock":false,"isSticky":false,"canSticky":false,"subscription":null,"canTag":false},"relationships":{"lastPostedUser":{"data":{"type":"users","id":"1"}}}},{"type":"discussions","id":"8","attributes":{"title":"Cloner une version particuli\u00e8re de TrinityCore","slug":"8-cloner-une-version-particuliere-de-trinitycore","commentCount":1,"participantCount":1,"createdAt":"2020-12-31T12:21:21+00:00","lastPostedAt":"2020-12-31T12:21:21+00:00","lastPostNumber":1,"canReply":false,"canRename":false,"canDelete":false,"canHide":false,"isApproved":true,"isLocked":false,"canLock":false,"isSticky":false,"canSticky":false,"subscription":null,"canTag":false},"relationships":{"lastPostedUser":{"data":{"type":"users","id":"1"}}}},{"type":"discussions","id":"20","attributes":{"title":"Apprendre le Lua : Session #2","slug":"20-apprendre-le-lua-session-2","commentCount":4,"participantCount":2,"createdAt":"2020-12-31T17:23:56+00:00","lastPostedAt":"2021-02-18T21:02:03+00:00","lastPostNumber":4,"canReply":false,"canRename":false,"canDelete":false,"canHide":false,"isApproved":true,"isLocked":false,"canLock":false,"isSticky":false,"canSticky":false,"subscription":null,"canTag":false},"relationships":{"lastPostedUser":{"data":{"type":"users","id":"2"}}}},{"type":"discussions","id":"55","attributes":{"title":"Cr\u00e9er une nouvelle Map","slug":"55-creer-une-nouvelle-map","commentCount":1,"participantCount":1,"createdAt":"2021-02-03T20:18:27+00:00","lastPostedAt":"2021-02-03T20:18:27+00:00","lastPostNumber":1,"canReply":false,"canRename":false,"canDelete":false,"canHide":false,"isApproved":true,"isLocked":false,"canLock":false,"isSticky":false,"canSticky":false,"subscription":null,"canTag":false},"relationships":{"lastPostedUser":{"data":{"type":"users","id":"18"}}}},{"type":"discussions","id":"53","attributes":{"title":"WoW Client Manager","slug":"53-wow-client-manager","commentCount":3,"participantCount":2,"createdAt":"2021-01-20T20:08:53+00:00","lastPostedAt":"2021-01-27T16:51:32+00:00","lastPostNumber":3,"canReply":false,"canRename":false,"canDelete":false,"canHide":false,"isApproved":true,"isLocked":false,"canLock":false,"isSticky":false,"canSticky":false,"subscription":null,"canTag":false},"relationships":{"lastPostedUser":{"data":{"type":"users","id":"1"}}}},{"type":"users","id":"2","attributes":{"username":"iThorgrim","displayName":"iThorgrim","avatarUrl":"https:\/\/forum.open-wow.eu\/assets\/avatars\/m2uNfA3ykacYo3KQ.png","slug":"iThorgrim","joinTime":null}},{"type":"users","id":"19","attributes":{"username":"Torvahal","displayName":"Torvahal","avatarUrl":"https:\/\/forum.open-wow.eu\/assets\/avatars\/Zj382QMdGN5T05KR.png","slug":"Torvahal","joinTime":null}},{"type":"users","id":"8","attributes":{"username":"Shard","displayName":"Shard","avatarUrl":"https:\/\/forum.open-wow.eu\/assets\/avatars\/bYoQgxVXNpTYgA1Z.png","slug":"Shard","joinTime":null}},{"type":"users","id":"1","attributes":{"username":"Galathil","displayName":"Galathil","avatarUrl":"https:\/\/forum.open-wow.eu\/assets\/avatars\/6zjneQm6RzYl44hc.png","slug":"Galathil","joinTime":null}},{"type":"users","id":"13","attributes":{"username":"noc","displayName":"noc","avatarUrl":null,"slug":"noc","joinTime":null}},{"type":"users","id":"15","attributes":{"username":"Mageex","displayName":"Mageex","avatarUrl":"https:\/\/forum.open-wow.eu\/assets\/avatars\/QrVwmaDacwoX2c40.png","slug":"Mageex","joinTime":null}},{"type":"users","id":"18","attributes":{"username":"Nehyren","displayName":"Nehyren","avatarUrl":"https:\/\/forum.open-wow.eu\/assets\/avatars\/JTiwGMIn9vWbQRVE.png","slug":"Nehyren","joinTime":null}}],"session":{"userId":0,"csrfToken":"56gBjg2XcniFhbMOLwxPdLdUgXHpfpWLri8GlaxS"},"locales":{"fr":"Fran\u00e7ais","en":"English"},"locale":"fr","fof-recaptcha.credentials.site":"6LfKZhoaAAAAALSGOmOPpIVRVM8XRksALQXeFtYW","fof-recaptcha.type":"","apiDocument":{"data":{"type":"discussions","id":"39","attributes":{"title":"Les protections de Blizzard","slug":"39-les-protections-de-blizzard","commentCount":1,"participantCount":1,"createdAt":"2021-01-09T15:42:21+00:00","lastPostedAt":"2021-01-09T15:42:21+00:00","lastPostNumber":1,"canReply":false,"canRename":false,"canDelete":false,"canHide":false,"isApproved":true,"isLocked":false,"canLock":false,"isSticky":false,"canSticky":false,"subscription":null,"canTag":false},"relationships":{"posts":{"data":[{"type":"posts","id":"65"}]},"tags":{"data":[{"type":"tags","id":"2"}]}}},"included":[{"type":"posts","id":"65","attributes":{"number":1,"createdAt":"2021-01-09T15:42:21+00:00","contentType":"comment","contentHtml":"\u003Cp\u003E\u003Cstrong\u003EImportant :\u003C\/strong\u003E Ce tutoriel a \u00e9t\u00e9 r\u00e9dig\u00e9 par Nobodie pour le site wow-emu.fr. Je le recopie ici \u00e0 l\u0027identique, Il se peut que certaines informations soient obsol\u00e8tes \u00e0 ce jour. Bonne lecture !\u003C\/p\u003E\n\n\u003Ch1\u003ELes protections de Blizzard\u003C\/h1\u003E\n\u003Cp\u003E\u003Cstrong\u003EPr\u00e9lude : Ce sujet n\u0027est pas original, il a \u00e9t\u00e9 transf\u00e9r\u00e9 d\u0027un pr\u00e9c\u00e9dent forum d\u0027\u00e9mulation en date d\u0027Octobre 2013. J\u0027en suis l\u0027auteur, je le transf\u00e8re donc pour les besoins de ce forum. Bien qu\u0027il soit en partie r\u00e9-\u00e9crit, il se peut que certains termes soient inadapt\u00e9s ou ne soient plus d\u0027actualit\u00e9.\u003C\/strong\u003E\u003C\/p\u003E\n\n\u003Cp\u003EBonjour \u00e0 tous,\u003C\/p\u003E\n\n\u003Cp\u003Eaujourd\u0027hui nous allons parler des protections mises en place par nos chers amis de Blizzard \u00e0 l\u0027encontre des serveurs priv\u00e9s. Il est aujourd\u0027hui tr\u00e8s difficile de d\u00e9velopper un serveur sous MoP, mais \u00e7a n\u0027a pas toujours \u00e9t\u00e9 le cas. Petit flashback dans le lointain pass\u00e9 des versions magiques 1.X, 2.X etc. Mais d\u0027abord, un petit point sur les \u00e9l\u00e9ments qui ont chang\u00e9.\u003C\/p\u003E\n\n\u003Cp\u003EAvant de faire le point sur les diff\u00e9rentes \u00e9volutions et complexifications du syst\u00e8me, nous allons rapidement r\u00e9fl\u00e9chir sur les \u0022leviers\u0022 sur lesquels Blizzard peut jouer pour mettre des b\u00e2tons dans les roues des serveurs de jeu. Si vous avez lu mon pr\u00e9c\u00e9dent guide sur le fonctionnement g\u00e9n\u00e9ral d\u0027un serveur de jeu, vous avez vu qu\u0027il existe plusieurs points critiques. Blizzard peut donc jouer par exemple sur le contenu, en cr\u00e9ant du contenu de plus en plus difficile \u00e0 impl\u00e9menter. C\u0027est tout \u00e0 fait faisable, mais techniquement, le but du contenu est de faire plaisir au joueur. Complexifier le contenu au d\u00e9triment du plaisir du joueur, c\u0027est un peu se tirer une balle dans le pied. Il pourrait \u00e9galement changer les syst\u00e8mes de jeu (par exemple, changer en profondeur le syst\u00e8me de d\u00e9gats pour faire des d\u00e9g\u00e2ts de zone \u00e0 la mani\u00e8re de Rift et non plus le syst\u00e8me de ciblage comme on le connait. Malheureusement, \u00e7a aussi, \u00e7a touche \u00e0 la politique m\u00eame du jeu. Non, pour enquiquiner le plus possible les d\u00e9veloppeurs de serveurs wow, il faut trouver quelque chose de bien plus machiav\u00e9lique \ud83d\ude00 Heureusement, il existe une solution qui regroupe tous ces points :\u003C\/p\u003E\n \u003Cul\u003E\u003Cli\u003EInd\u00e9pendant du gameplay du jeu\u003C\/li\u003E\n \u003Cli\u003EImpossible \u00e0 contourner (pour que les serveurs priv\u00e9s soient oblig\u00e9s de s\u0027y conformer)\u003C\/li\u003E\n \u003Cli\u003EPeu co\u00fbteux\u003C\/li\u003E\n \u003Cli\u003EInvisible pour les joueurs (comme \u00e7a en plus les joueurs du priv\u00e9 ne voient pas que les d\u00e9veloppeurs font un gros travail ! Quand je vous disais que c\u0027\u00e9tait machiav\u00e9lique \ud83d\ude09)\u003C\/li\u003E\u003C\/ul\u003E\n\n\u003Cp\u003EIl existe un seul syst\u00e8me qui regroupe tous ces points sur lequel Blizzard peut tout g\u00e9rer : il s\u0027agit de la couche R\u00e9seau ! Tout le protocole de communication Client\u0026lt;-\u0026gt;Serveur. Il est :\u003C\/p\u003E\n\n \u003Cul\u003E\u003Cli\u003E\u003Cstrong\u003EInd\u00e9pendant du gameplay du jeu :\u003C\/strong\u003E C\u0027est la couche la plus basse du jeu. Peu importe le syst\u00e8me qui se trouve au dessus, les donn\u00e9es sont envoy\u00e9es.\u003C\/li\u003E\n \u003Cli\u003E\u003Cstrong\u003EImpossible \u00e0 contourner :\u003C\/strong\u003E C\u0027est un syst\u00e8me tr\u00e8s sensible. Si le client attend de recevoir un message contenant l\u0027id du joueur, son level, ses spells et un pain au chocolat, alors le client doit recevoir l\u0027id du joueur, son level, ses spells et un pain au chocolat. Si il y a une erreur, vous obtenez a coup s\u00fbr soit un crash client, soit un comportement ingame tout \u00e0 fait mortel. Et impossible de contourner ce syst\u00e8me pour le serveur, il est tellement imbriqu\u00e9 dans le client que tenter de cracker le syst\u00e8me revient \u00e0 recoder tout cela .... en assembleur \ud83d\ude00 bonne chance \u00e0 vous \ud83d\ude09\u003C\/li\u003E\n \u003Cli\u003E\u003Cstrong\u003EPeu co\u00fbteux :\u003C\/strong\u003E Techniquement, \u00e7a ne co\u00fbte rien d\u0027inverser des valeurs \u00e0 chaque mise \u00e0 jour. Il suffit que le serveur officiel fasse cette inversion \u00e9galement. Facile lorsque Blizzard poss\u00e8de les sources de son propre jeu. Sans avoir les sources, cela devient beaaaaaucoup plus complexe.\u003C\/li\u003E\n \u003Cli\u003E\u003Cstrong\u003EInvisible pour les joueurs :\u003C\/strong\u003E Qui s\u0027est d\u00e9j\u00e0 rendu compte que derri\u00e8re un jeu tel que Wow, vous envoyiez l\u0027\u00e9quivalent de 100 gros SMS chaque seconde ? Pas moi, avant de me confronter \u00e0 cette horreur.\u003C\/li\u003E\u003C\/ul\u003E\n\n\u003Cp\u003ELa couche R\u00e9seau est donc le fier gagnant, et depuis les d\u00e9buts de Wow, Blizzard \u0022s\u0027amuse\u0022 \u00e0 notre grand regret, \u00e0 obfusquer un peu plus chaque version. Les paquets envoy\u00e9s se sont donc petit \u00e0 petit allong\u00e9s et complexifi\u00e9s, comme nous allons le voir sous peu.\u003C\/p\u003E\n\n\u003Cp\u003EDernier petit rappel pr\u00e9liminaire : Le contenu d\u0027un paquet \u0022type\u0022.\u003C\/p\u003E\n\n\u003Cp\u003EImaginons un paquet type simplifi\u00e9. Ce paquet est un paquet utilis\u00e9 \u00e0 la fois du c\u00f4t\u00e9 client, comme du c\u00f4t\u00e9 serveur (sa structure est la m\u00eame des deux c\u00f4t\u00e9s). Il contient les informations suivantes :\u003C\/p\u003E\n \u003Cul\u003E\u003Cli\u003EUn Opcode sur 2 octets : C\u0027est l\u0027identifiant pur du paquet. Il sert \u00e0 identifier le paquet pour savoir quoi en faire (par exemple, imaginons l\u0027opcode 100 qui est charg\u00e9 d\u0027envoyer des infos sur un joueur)\u003C\/li\u003E\n \u003Cli\u003EUn Guid sur 8 octets : C\u0027est l\u0027identifiant du joueur pour lequel on envoie ces informations.\u003C\/li\u003E\n \u003Cli\u003EUn float (un chiffre \u00e0 virgule) sur 4 octets : la hauteur du joueur par rapport au sol. Cette information permet de savoir si le joueur est en train de voler.\u003C\/li\u003E\n \u003Cli\u003EUne cha\u00eene de caract\u00e8res sur X octets : C\u0027est le nom du joueur. Comme on ne sait pas d\u0027avance quelle taille fait cette cha\u00eene, on utilise un caract\u00e8re sp\u00e9cial en fin de cha\u00eene pour signifier qu\u0027on vient de terminer la lecture (si on veut \u00e9crire NoboDie, on \u00e9crit le pseudo suivi d\u0027un caract\u00e8re 0x00, un caract\u00e8re NULL d\u00e9limitant la fin de la cha\u00eene)\u003C\/li\u003E\n \u003Cli\u003EUn compteur sur 1 octet : ce compteur va nous indiquer le nombre d\u0027\u00e9l\u00e9ments qui vont \u00eatre envoy\u00e9s dans la boucle suivante.\u003C\/li\u003E\n \u003Cli\u003EUne boucle qui envoie une variable sur 4 octets : Un Id de spell. Imaginons que le joueur ai appris 4 sorts. Le compteur pr\u00e9c\u00e9dent vaudra 4, et la boucle remplira le paquet avec 4 IDs de spells les uns apr\u00e8s les autres.\u003C\/li\u003E\u003C\/ul\u003E\n\n\u003Cp\u003ECeci est un paquet tr\u00e8s simple qui n\u0027est l\u00e0 que pour l\u0027exemple. Evidemment, le syst\u00e8me envoie une multitude de paquets diff\u00e9rents et atrement plus complexes que celui-ci, mais il faut bien un d\u00e9but \u00e0 tout et ce paquet \u0022type\u0022 regroupe diff\u00e9rents types de variables que l\u0027ont est amen\u00e9s \u00e0 rencontrer sur wow.\u003C\/p\u003E\n\n\u003Cp\u003EDernier point sur la fa\u00e7on la plus simple dont un paquet peut \u00eatre trait\u00e9 (en fait, comme \u00e7a a \u00e9t\u00e9 fait au d\u00e9but). Le syst\u00e8me le plus simple est d\u0027avoir un tableau du type tableau[opcode] = fonctionquiremplitlepaquet();\u003C\/p\u003E\n\n\u003Cp\u003EC\u0027est assez intuitif : on associe \u00e0 chaque opcode (qui, je le rappelle, est l\u0027identifiant du paquet et sert \u00e0 savoir de quoi il va parler), la fonction qui le traite (dans le cas ou le message arrive vers le client) ou la fonction qui le remplit (dans le cas ou le message part du client). Nous verrons que cela s\u0027est \u00e9videmment complexifi\u00e9 au fil des ann\u00e9es \ud83d\ude09\u003C\/p\u003E\n\n\u003Cp\u003EBien, maintenant que nous avons d\u00e9fini un paquet (fictif, je le rappelle) et la fa\u00e7on la plus simple de le traiter, voyons comment celui-ci a pu \u00eatre g\u00e9r\u00e9 au fil des versions (je ne complexifie pas les choses, c\u0027est r\u00e9ellement le fonctionnement du syst\u00e8me)\u003C\/p\u003E\n\n\u003Ch2\u003E1. Le bonheur de Wow Vanilla\u003C\/h2\u003E\n\n\u003Cp\u003EOk, on commence doucement, Blizzard vient de sortir son premier MMOrpg, il faudrait pas qu\u0027ils ne se plantent et que leur jeu ait des soucis. Afin de simplifier l\u0027explication, je ne traiterais ici que l\u0027envoi et la r\u00e9ception de variables de type UINT64, cad en g\u00e9n\u00e9ral un Guid (de joueur, de cr\u00e9ature, d\u0027item, ...) :\u003C\/p\u003E\n\n\u003Cpre\u003E\u003Ccode class=\u0022language-cpp\u0022\u003Eint64 guid;\npacket \u0026lt;\u0026lt; guid;\u003C\/code\u003E\u003Cscript async=\u0022\u0022 crossorigin=\u0022anonymous\u0022 data-hljs-style=\u0022github-gist\u0022 integrity=\u0022sha384-eud4nQrKZMwcYak7or3J5ZPJx1x4HRe8iTTHJy1SUVrDD+fP30Bo\/F8OSdQJpk8d\u0022 onload=\u0022hljsLoader.highlightBlocks(this.parentNode)\u0022 src=\u0022https:\/\/cdn.jsdelivr.net\/gh\/s9e\/hljs-loader@1.0.18\/loader.min.js\u0022\u003E\u003C\/script\u003E\u003C\/pre\u003E\n\n\u003Cp\u003EComme vous pouvez vous rendre compte, le syst\u00e8me est tr\u00e8s simple. Aujourd\u0027hui, 100% des paquets de la 1.X sont connus. Encore heureux me direz-vous, \u00e7a fait 10 ans qu\u0027elle existe ^^. Aucune modification sur le protocole de communication n\u0027a \u00e9t\u00e9 faite sur l\u0027ensemble de la p\u00e9riode 1.X (Wow Vanilla). Les serveurs Vanilla pouvaient donc vivre tranquilles. Il y avait seulement une centaine de paquets diff\u00e9rents.\u003C\/p\u003E\n\n\u003Ch2\u003E2. Wow Burning Crusade, \u00e7a commence ..\u003C\/h2\u003E\n\n\u003Cp\u003EArriv\u00e9e de la nouvelle extension. Surprise, avec les nouveaut\u00e9s du gameplay, pr\u00e8s de 200 nouveaux opcodes (et donc paquets) apparaissent, ce qui multiplie par 3 le travail. Heureusement, les 100 premiers paquets ne changent pas d\u0027identifiant, il est donc facile d\u0027avoir une version \u00e0 peu pr\u00e8s aussi fonctionnelle que la version 1.X Vanilla. Autre nouveaut\u00e9, certains paquets ne sont utilis\u00e9s que dans un sens (du serveur vers le client par exemple). Ca ne pose pas gros probl\u00e8me, les opcodes sont toujours enregistr\u00e9s dans un tableau avec leur handler associ\u00e9. Presque du bonheur, j\u0027vous dit \ud83d\ude00.Toujours aucun changement d\u0027une sous version \u00e0 une autre, en dehors de nouveaux opcodes pour les nouvelles fonctionnalit\u00e9s. On passe \u00e0 la suite.\u003C\/p\u003E\n\n\u003Col style=\u0022list-style-type:decimal\u0022 start=\u00223\u0022\u003E\u003Cli\u003EWow Wrath Of The Lich King, A\u00efe ...\u003C\/li\u003E\u003C\/ol\u003E\n\n\u003Cp\u003EEt voil\u00e0, \u00e7a devait arriver. Evidemment, \u00e7a devenait trop simple de trouver les opcodes directement dans le tableau de handlers. Les opcodes sont maintenant de trois types : les opcodes d\u0027authentification (les authOpcodes), les opcodes de type JAM (les jamOpcodes) et les opcodes de type table (les tableOpcodes). Ces derniers sont toujours enregistr\u00e9s via un tableau, mais il faut maintenant faire un calcul sur l\u0027opcode. L\u0027opcode n\u0027est plus enregistr\u00e9 en dur, il faut donc jouer et sniffer les paquets pour trouver les correspondances. Ca devient long en temps de calcul. Par contre, les opcodes sont toujours les m\u00eames depuis la premi\u00e8re extension, on peut encore retrouver des choses. Ouf !\u003C\/p\u003E\n\n\u003Cp\u003EOh et puis tiens, on va plus simplement envoyer les GUIDs tels qu\u0027ils sont, c\u0027est \u00e0 dire un uint64 (8 octets). On va maintenant faire un packedGUID. C\u0027est la m\u00eame chose, mais on va mettre en place un algorithme pour rapetisser le guid comme \u00e7a non seulement il ne prendra plus 8 octets en taille, mais en plus il sera plus compliqu\u00e9 \u00e0 d\u00e9chiffrer pour les d\u00e9veloppeurs du priv\u00e9. Niark, Evil inside x)\u003C\/p\u003E\n\n\u003Cp\u003EEn revanche, il \u0022suffit\u0022 de comprendre le syst\u00e8me une seule fois, puisqu\u0027ensuite c\u0027est la m\u00eame fonction qui est appel\u00e9e \u00e0 chaque fois.\u003C\/p\u003E\n\u003Cpre\u003E\u003Ccode class=\u0022language-cpp\u0022\u003Eint64 appendPackedGuid(int64 guid) {\nuint8 packGUID[8+1];\npackGUID[0] = 0;\nsize_t size = 1;\nfor (uint8 i = 0;guid != 0;++i) {\nif (guid \u0026amp; 0xFF) {\npackGUID[0] |= uint8(1 \u0026lt;\u0026lt; i);\npackGUID[size] = uint8(guid \u0026amp; 0xFF);\n++size;\n}\nguid \u0026gt;\u0026gt;= 8;\n}\nappend(packGUID, size);\n}\n\nint64 guid;\npacket.appendPackedGuid(guid);\u003C\/code\u003E\u003Cscript async=\u0022\u0022 crossorigin=\u0022anonymous\u0022 data-hljs-style=\u0022github-gist\u0022 integrity=\u0022sha384-eud4nQrKZMwcYak7or3J5ZPJx1x4HRe8iTTHJy1SUVrDD+fP30Bo\/F8OSdQJpk8d\u0022 onload=\u0022hljsLoader.highlightBlocks(this.parentNode)\u0022 src=\u0022https:\/\/cdn.jsdelivr.net\/gh\/s9e\/hljs-loader@1.0.18\/loader.min.js\u0022\u003E\u003C\/script\u003E\u003C\/pre\u003E\n\n\u003Cp\u003EVous avez l\u0027impression que \u00e7a se complique ? c\u0027est bien, vous n\u0027avez encore rien vu ...\u003C\/p\u003E\n\n\u003Ch2\u003E4. Wow Cataclysm, La revanche du Retour du Jedi ...\u003C\/h2\u003E\n\n\u003Cp\u003EBon aller maintenant \u00e7a suffit, on en a marre des serveurs priv\u00e9s ! Oh punaise ils vont en baver l\u00e0 ! On va leur implanter ... des Opcodes al\u00e9atoires ! Waouw grande id\u00e9e ! Ca revient \u00e0 quoi ? et bien, \u00e0 chaque sous version (4.0.6, 4.1.0, 4.1.0a, 4.1.3, ...) on va changer al\u00e9atoirement tous les Opcodes ! Hop hop hop ! Oh et puis tant qu\u0027\u00e0 faire, on va inverser les structures de chaque paquet ! Ca se traduit par plusieures choses pour les serveurs priv\u00e9s :\u003C\/p\u003E\n\n \u003Cul\u003E\u003Cli\u003EPlus possible de se baser sur les versions pr\u00e9c\u00e9dentes pour retrouver les handlers, il faut tout refaire de z\u00e9ro !\u003C\/li\u003E\n \u003Cli\u003ELe serveur officiel change d\u0027opcodes chaque version. Si on veut passer \u00e0 la version suivante, il faut \u00e0 nouveau tout refaire.\u003C\/li\u003E\n \u003Cli\u003EPour trouver les informations sur Wotlk et identifier les paquets\/structures, on utilisait des sniffers. C\u0027est cool les sniffers, sauf que vu que l\u0027officiel change se paquets \u00e0 chaque version, \u00e7a veut dire que les sniffs ne sont valables que le temps d\u0027une version. S\u0027il nous manque les sniffs pour un syst\u00e8me tel que celui des guildes, on perd tout espoir d\u0027ouvrir le syst\u00e8me de guilde dans des temps raisonnables. Biens\u00fbr, les sniffs ne sont pas indispensables, mais ils simplifient l\u00e9g\u00e8rement le travail. Une fois le serveur officiel pass\u00e9 \u00e0 une version ult\u00e9rieure, impossible de refaire des sniffs pour la version travaill\u00e9e actuellement. Difficile, n\u0027est-ce pas ? \ud83d\ude00 Et ce n\u0027est pas tout pour cette version ...\u003C\/li\u003E\u003C\/ul\u003E\n\n\u003Cp\u003EArriv\u00e9e de la version 4.3.4. Les serveurs priv\u00e9s en 4.0.6 commencent \u00e0 pulluler, et \u00e7a, c\u0027est pas bon pour Blizzard. Alors pour \u00e9viter que des serveurs 4.3.4 n\u0027arrivent trop vite, on va inventer .... Les GUIDs XOR\u00e9s ! MOUAHAHAHAHAHAHAH\u003C\/p\u003E\n\n\u003Cp\u003EComment \u00e7a marche ? et bien c\u0027est un nouvel algorithme qui complexifie l\u0027envoi des GUIDs. Basiquement, on envoie un premier octet qui sert de \u0022mode d\u0027emploi\u0022 \u00e0 la lecture du guid. Chaque bit de l\u0027octet correspond \u00e0 un octet du guid (vous me suivez l\u00e0 ? x)). Si le bit est \u00e0 1, alors il faudra lire l\u0027octet correspondant. Et puis comme c\u0027st trop simple, on va le XORer avec cette valeur justement comme \u00e7a on est s\u00fbrs que c\u0027est bien compliqu\u00e9. Oh et puis comme maintenant on a divis\u00e9 le guid en deux (octet \u0022mode d\u0027emploi\u0022 et guid \u00e0 part), et bien on va envoyer l\u0027octet au d\u00e9but, et puis le guid plus loin. Oh et puis, puisqu\u0027on peut lire chaque octet du guid s\u00e9par\u00e9ment selon le mode d\u0027emploi, on va envoyer d\u0027abord les 2 premiers octets du guid, puis on va envoyer quelques autres variables inutiles, puis les 4 octets suivants du guid. Puis quelques autres variables, puis enfin les deux dernier octets ! ouais, \u00e7a \u00e7a va \u00eatre bien !\u003C\/p\u003E\n\n\u003Cp\u003EAh au passage, on va aussi cr\u00e9er une nouvelle fa\u00e7on d\u0027envoyer une chaine de caract\u00e8res. On va envoyer la taille \u00e0 part, puis la cha\u00eene sans caract\u00e8re de fin (le NULL dont on a parl\u00e9 plus haut). Aller avec \u00e7a, je crois que c\u0027est bon on leur en a fait assez baver ...\u003C\/p\u003E\n\n\u003Ch2\u003E5. Wow Mists Of Pandaria, Pour moi ce sera un bon Random avec une rondelle de citron et des gla\u00e7ons. Oh et apportez de la cr\u00e8me pour la rondelle ... beaucoup de cr\u00e8me ....\u003C\/h2\u003E\n\n\u003Cp\u003EQUoi ?! ils ont sorti un TrinityCore 4.3.4 ? Ok ! Maintenant \u00e7a va CH#\u0026amp;\u003Csup\u003EER\u003C\/sup\u003E !!!\u003C\/p\u003E\n\n\u003Cp\u003EOkkkk donc on prend tous les ajouts de la 4.3.4 (donc les Random Opcodes \u00e0 chaque mise \u00e0 jour interm\u00e9diaire, ainsi que la nouvelle fa\u00e7on de XORer un GUID). Et comme c\u0027est devenu trop facile pour eux, on va faire encore pire. Avant, on envoyait le mask dans l\u0027ordre, et le guid dans l\u0027ordre, il \u00e9tait juste \u00e9parpill\u00e9 dans tout le code. Et bien maintenant, on va envoyer tout \u00e7a dans le d\u00e9sordre AHAH ! Et en plus on va faire \u00e7a \u00e0 chaque mise \u00e0 jour interm\u00e9diaire ! MUAHAHAHAHAHAHA (vous voyez pourquoi on a besoin de la cr\u00e8me maintenant ?)\u003C\/p\u003E\n\n\u003Cp\u003EDonc \u00e0 pr\u00e9sent, et bien on va envoyer le bit 4 du mask, puis le 7, le 3, le 2, le 0, puis on va envoyer 20 autres bits qui servent \u00e0 autre chose qui va bien foutre le bordel, puis on va envoyer le bit 1, le bit 6, et le num\u00e9ro compl\u00e9mentaire, le 5 ! Par ici les gagnants du Loto. Oh pardon, vous avez loup\u00e9 votre chance ? vous en avez une deuxi\u00e8me avec le GUID : envoyez d\u0027abord l\u0027octet 3 du guid, puis le 2, puis le 7, puis le 1, puis le 0, puis le 6, puis le 5. On non attendez, foutez quelques variables moisies entre tout \u00e7a, et finissez par l\u0027octet 4 ! Bravo au gagnant de l\u0027\u00eele-et-vilaine, il vient de remporter ... ah bah non rien, car il doit faire \u00e7a pour encore 1500 autres paquets ...\u003C\/p\u003E\n\n\u003Cpre\u003E\u003Ccode class=\u0022language-cpp\u0022\u003Epacket.WriteBit(guid[4]);\npacket.WriteBit(guid[3]);\npacket.WriteBit(guid[6]);\n... 10 autres donn\u00e9es qui n\u0027ont rien \u00e0 voir\npacket.WriteBit(guid[2]);\npacket.WriteBit(guid[5]);\npacket.WriteBit(guid[0]);\n... puis 3 autres\npacket.WriteBit(guid[7]);\n... puis une\npacket.WriteBit(guid[1]);\n... encore deux\npacket.WriteByteSeq(guid[2]);\n... Un pikachu sauvage appara\u00eet ici\npacket.WriteByteSeq(guid[0]);\npacket.WriteByteSeq(guid[6]);\n... J\u0027aime les Kiwis\npacket.WriteByteSeq(guid[3]);\npacket.WriteByteSeq(guid[4]);\npacket.WriteByteSeq(guid[1]);\n... Ca sent le br\u00fbl\u00e9 :\/\npacket.WriteByteSeq(guid[5]);\n... Serait-ce la fin des haricots ?\npacket.WriteByteSeq(guid[7]);\n... OH YEAH ENCORE DES CHOSES MAIS ON A ENFIN FINI D\u0027ENVOYER LE GUID !\u003C\/code\u003E\u003Cscript async=\u0022\u0022 crossorigin=\u0022anonymous\u0022 data-hljs-style=\u0022github-gist\u0022 integrity=\u0022sha384-eud4nQrKZMwcYak7or3J5ZPJx1x4HRe8iTTHJy1SUVrDD+fP30Bo\/F8OSdQJpk8d\u0022 onload=\u0022hljsLoader.highlightBlocks(this.parentNode)\u0022 src=\u0022https:\/\/cdn.jsdelivr.net\/gh\/s9e\/hljs-loader@1.0.18\/loader.min.js\u0022\u003E\u003C\/script\u003E\u003C\/pre\u003E\n\n\u003Cp\u003EOh et puis on revient au sujet des Opcodes qui \u00e9taient divis\u00e9s en 3 cat\u00e9gories. Bon c\u0027est trop simple, on va les diviser en 7 et puis on va mettre une formule math\u00e9matique bien pourrave pour bien les emm..... ces d\u00e9veloppeurs de serveurs priv\u00e9s !\u003C\/p\u003E\n\n\u003Cp\u003EEt bien vous savez quoi ? ce n\u0027est pas suffisant ! On l\u0027a fait les amis ! On travaille bel et bien sur cette version et on va en sortir une tr\u00e8s prochainement ! (un peu de pub personnelle n\u0027a jamais fait de mal :3)\u003C\/p\u003E\n\n\u003Ch2\u003E6. (Annexe) Prochaine extension, quelques id\u00e9es pour nous faire suer un peu plus\u003C\/h2\u003E\n\n\u003Cp\u003EEt oui on est comme \u00e7a nous ! On donne qelques id\u00e9es au cas ou Blizzard serait en manque d\u0027inspiration ! Top 5 des meilleures id\u00e9es :\u003C\/p\u003E\n \u003Col style=\u0022list-style-type:decimal\u0022\u003E\u003Cli\u003EOn randomize les variables elles m\u00eames. Rien de mieux que d\u0027envoyer une variable sur 12 bits m\u00e9lang\u00e9s !\u003C\/li\u003E\n \u003Cli\u003EOn pr\u00e9voit plusieurs opcodes pour le m\u00eame paquet ! Ben oui, si on utilise plusieurs opcodes, \u00e7a devient gal\u00e8re d\u0027automatiser l\u0027identification des opcodes dans les sniffs !\u003C\/li\u003E\n \u003Cli\u003EOn cr\u00e9\u00e9e un paquet qui d\u00e9finit comment on d\u00e9finit le paquet qui va \u00eatre r\u00e9ellement envoy\u00e9 ! Yo dawg, j\u0027ai entendu dire que tu aimais les paquets de paquets de paquets de paquets ...\u003C\/li\u003E\n \u003Cli\u003EOn r\u00e9invente tout un nouveau syst\u00e8me de paquet 100% diff\u00e9rent de la version pr\u00e9c\u00e9dente, comme \u00e7a on est s\u00fbrs de bien foutre tout le monde dans la merde !\u003C\/li\u003E\n \u003Cli\u003EOn sort le code source en version publique et on arr\u00eate d\u0027emb\u00eater les serveurs priv\u00e9s qui amm\u00e8nent du monde sur officiel (ben quoi, j\u0027ai le droit de r\u00eaver non ? \ud83d\ude1f)\u003C\/li\u003E\u003C\/ol\u003E\n\n\n\u003Ch2\u003E7. Le point sur Warlords of Draenor\u003C\/h2\u003E\n\n\u003Cp\u003ECette partie est rajout\u00e9e pr\u00e8s d\u0027un an apr\u00e8s l\u0027\u00e9criture des premi\u00e8res parties du tutoriel. Celle-ci fait le point sur ce qui a \u00e9t\u00e9 mis en place par Blizzard entre temps pour la sortie de leur prochaine extension\u003C\/p\u003E\n\n\u003Cp\u003EAlors, tout d\u0027abord, il faut savoir qu\u0027au passage de la 5.3, il y a eu un changement tr\u00e8s utile pour les serveurs priv\u00e9s : l\u0027arriv\u00e9e d\u0027un nouveau compilateur chez Blizzard. Et ce compilateur apporte une chose tr\u00e8s int\u00e9ressante : un mauvais support des fonctions inline (ou, du moins, cela n\u0027a pas \u00e9t\u00e9 activ\u00e9 correctement du c\u00f4t\u00e9 des d\u00e9veloppeurs de Blizzard). Cela a pour effet de rendre le code source client bien plus lisible. Voil\u00e0 un exemple :\u003C\/p\u003E\n\n\u003Cp\u003ECe code c\u00f4t\u00e9 client en 5.1 :\u003C\/p\u003E\n\u003Cpre\u003E\u003Ccode class=\u0022language-cpp\u0022\u003Eif ( v11 == 8 )\n{\nLOBYTE(a2) = 0;\nCDataStore__GetInt8(this, (int)\u0026amp;a2);\nv10 = a2;\nv11 = 0;\n}\nv17 = (unsigned int)v10 \u0026gt;\u0026gt; 7;\nv16 = v11 + 1;\nv15 = 2 * v10;\n*(_BYTE *)(v12 + *((_DWORD *)v6 + 7) + 7) = v17;\nif ( v16 == 8 )\n{\nLOBYTE(a2) = 0;\nCDataStore__GetInt8(this, (int)\u0026amp;a2);\nv15 = a2;\nv16 = 0;\n}\nv20 = (unsigned int)v15 \u0026gt;\u0026gt; 7;\nv19 = v16 + 1;\nv18 = 2 * v15;\n*(_BYTE *)(v12 + *((_DWORD *)v6 + 7)) = v20;\nif ( v19 == 8 )\n{\nLOBYTE(a2) = 0;\nCDataStore__GetInt8(this, (int)\u0026amp;a2);\nv18 = a2;\nv19 = 0;\n}\nv23 = (unsigned int)v18 \u0026gt;\u0026gt; 7;\nv22 = v19 + 1;\nv21 = 2 * v18;\n*(_BYTE *)(v12 + *((_DWORD *)v6 + 7) + 4) = v23;\nif ( v22 == 8 )\n{\nLOBYTE(a2) = 0;\nCDataStore__GetInt8(this, (int)\u0026amp;a2);\nv21 = a2;\nv22 = 0;\n}\nv26 = (unsigned int)v21 \u0026gt;\u0026gt; 7;\nv25 = v22 + 1;\nv24 = 2 * v21;\n*(_BYTE *)(v12 + *((_DWORD *)v6 + 7) + 90) = v26;\nif ( v25 == 8 )\n{\nLOBYTE(a2) = 0;\nCDataStore__GetInt8(this, (int)\u0026amp;a2);\nv24 = a2;\nv25 = 0;\n}\u003C\/code\u003E\u003Cscript async=\u0022\u0022 crossorigin=\u0022anonymous\u0022 data-hljs-style=\u0022github-gist\u0022 integrity=\u0022sha384-eud4nQrKZMwcYak7or3J5ZPJx1x4HRe8iTTHJy1SUVrDD+fP30Bo\/F8OSdQJpk8d\u0022 onload=\u0022hljsLoader.highlightBlocks(this.parentNode)\u0022 src=\u0022https:\/\/cdn.jsdelivr.net\/gh\/s9e\/hljs-loader@1.0.18\/loader.min.js\u0022\u003E\u003C\/script\u003E\u003C\/pre\u003E\n\n\u003Cp\u003EDevient celui-ci c\u00f4t\u00e9 client en 5.4 :\u003C\/p\u003E\n\u003Cpre\u003E\u003Ccode class=\u0022language-cpp\u0022\u003E*(_BYTE *)(*((_DWORD *)v3 + 5) + v5 + 91) = CDataStore__ReadBit(\u0026amp;v36);\n*(_BYTE *)(*((_DWORD *)v3 + 5) + v5 + 104) = CDataStore__ReadBit(\u0026amp;v36) != 0;\n*(_BYTE *)(*((_DWORD *)v3 + 5) + v5 + 6) = CDataStore__ReadBit(\u0026amp;v36);\n*(_BYTE *)(*((_DWORD *)v3 + 5) + v5 + 89) = CDataStore__ReadBit(\u0026amp;v36);\n*(_BYTE *)(*((_DWORD *)v3 + 5) + v5 + 1) = CDataStore__ReadBit(\u0026amp;v36);\n*(_BYTE *)(*((_DWORD *)v3 + 5) + v5 + 5) = CDataStore__ReadBit(\u0026amp;v36);\n*(_BYTE *)(*((_DWORD *)v3 + 5) + v5 + 94) = CDataStore__ReadBit(\u0026amp;v36);\u003C\/code\u003E\u003Cscript async=\u0022\u0022 crossorigin=\u0022anonymous\u0022 data-hljs-style=\u0022github-gist\u0022 integrity=\u0022sha384-eud4nQrKZMwcYak7or3J5ZPJx1x4HRe8iTTHJy1SUVrDD+fP30Bo\/F8OSdQJpk8d\u0022 onload=\u0022hljsLoader.highlightBlocks(this.parentNode)\u0022 src=\u0022https:\/\/cdn.jsdelivr.net\/gh\/s9e\/hljs-loader@1.0.18\/loader.min.js\u0022\u003E\u003C\/script\u003E\u003C\/pre\u003E\n\n\u003Cp\u003EComme vous le constatez, le changement est appr\u00e9ciable et permet d\u0027aller un peu plus vite sur le reversing de paquets contenant des GUIDs de joueur. Il permet \u00e9galement de lire le code de fa\u00e7on it\u00e9rative plut\u00f4t que de v\u00e9rifier que certaines optimisations du compilateur n\u0027aient eu lieu (par exemple, lire plusieurs donn\u00e9es du paquet puis les \u00e9crire dans un ordre diff\u00e9rent nous a pos\u00e9 un certain nombre de probl\u00e8mes sur la 5.1 \u00e0 l\u0027\u00e9poque).\u003C\/p\u003E\n\n\u003Cp\u003EUn autre petit changement que nous avions pr\u00e9vu mais qui n\u0027est pas si probl\u00e9matique au final, est l\u0027utilisation du m\u00eame opcode pour plusieurs syst\u00e8mes diff\u00e9rents. Sans rentrer dans les d\u00e9tails, l\u0027opcode est tout de m\u00eame facilement identifiable selon le contexte d\u0027ex\u00e9cution et il n\u0027est finalement pas si probl\u00e9matique.\u003C\/p\u003E\n\n\u003Cp\u003EUn des changements majeurs impr\u00e9vus a \u00e9t\u00e9 la modification du syst\u00e8me de fichier g\u00e9rant les ressources du jeu (mod\u00e8les 3D, DBCs, etc). Le syst\u00e8me est pass\u00e9 de MoPaQ (les fameux MPQs) \u00e0 CASC (voir ICI) ce qui n\u00e9cessite de recoder l\u0027ensemble des logiciels d\u0027extraction (dbc, maps, vmaps et mmaps).\u003C\/p\u003E\n\n\u003Cp\u003EMais, en dehors de \u00e7a, le plus gros challenge reste la mise \u00e0 jour du protocole d\u0027authentification. Pour faire simple, avant Wotlk il n\u0027y avait qu\u0027un seul protocole appel\u00e9 le GruntLogin. Puis, de Wotlk \u00e0 MoP, Blizzard a int\u00e9gr\u00e9 le protocole BattleNet tout en maintenant le protocole GruntLogin. Jusqu\u0027\u00e0 ce jour, tous les serveurs priv\u00e9s tournent donc sur ce protocole et n\u0027utilisent aucunement le protocole BattleNet. A pr\u00e9sent, avec WoD, le GruntLogin n\u0027existe plus et seul le protocole BattleNet est utilisable. Il faut donc reverse l\u0027ensemble du protocole BattleNet bien plus complexe (la DLL de BattleNet est connue pour \u00eatre une des plus obfusqu\u00e9es)\u003C\/p\u003E\n\n\u003Cp\u003EQuelques sandbox WoD existent d\u00e9j\u00e0 sur Internet, mais elles passent habilement l\u0027\u00e9cran de login. En r\u00e9alit\u00e9, ils consid\u00e8rent toute personne qui tente de se connecter comme authentifi\u00e9e \u00e0 un seul et unique compte. Cela a l\u0027avantage de pouvoir rapidement annoncer qu\u0027une sandbox est disponible, mais seule 1 personne peut se connecter en m\u00eame temps et la protection des comptes joueurs est impossible (puisque chacun peut se faire passer pour un autre)\u003C\/p\u003E\n\n\u003Cp\u003EAu final, le protocole BattleNet sera certainement le plus grand d\u00e9fi propos\u00e9 \u00e0 l\u0027\u00e9mulation mondiale et nuls doutes que cette \u00e9pine saura causer de nombreux probl\u00e8mes \u00e0 qui souhaite ouvrir un serveur Warlords of Draenor.\u003C\/p\u003E\n\n\n\u003Cp\u003EVoil\u00e0 qui cl\u00f4ture ce guide des protections de Blizzard \u00e0 l\u0027encontre des serveurs priv\u00e9s. Vous remarquerez dans mes \u00e9crits une once d\u0027\u00e9nervement (oh, si peu :x) mais avec ces explications, j\u0027esp\u00e8re que vous serez un peu plus attentifs \u00e0 la complexit\u00e9 du syst\u00e8me et aux raisons pour lesquelles tr\u00e8s peu de serveurs ouvrent leurs portes avec la derni\u00e8re version en date. J\u0027esp\u00e8re \u00e9galement que vous comprendrez pourquoi il n\u0027est plus possible de suivre aussi rapidement l\u0027officiel par rapport \u00e0 l\u0027\u00e9poque Burning Crusade\/Wotlk.\u003C\/p\u003E\n\n\u003Cp\u003EJ\u0027esp\u00e8re que ce guide vous aura plu et vous permettra de prendre conscience de la t\u00e2che colossale qui se cache r\u00e9ellement derri\u00e8re un serveur priv\u00e9, et que ce n\u0027est pas juste une histoire de contenu pur (qui s\u0027av\u00e8re finalement \u00eatre assez simple compte tenu de la difficult\u00e9 principale qu\u0027est le protocole de communication). \u003Cdel\u003EComme d\u0027habitude, je reste ouvert \u00e0 toutes les remarques et appr\u00e9ciations constructives\u003C\/del\u003E\u003C\/p\u003E","editedAt":"2021-01-09T15:55:07+00:00","canEdit":false,"canDelete":false,"canHide":false,"isApproved":true,"canApprove":false,"canFlag":false,"canLike":false},"relationships":{"discussion":{"data":{"type":"discussions","id":"39"}},"user":{"data":{"type":"users","id":"1"}},"editedUser":{"data":{"type":"users","id":"1"}},"likes":{"data":[{"type":"users","id":"2"}]},"mentionedBy":{"data":[]}}},{"type":"users","id":"1","attributes":{"username":"Galathil","displayName":"Galathil","avatarUrl":"https:\/\/forum.open-wow.eu\/assets\/avatars\/6zjneQm6RzYl44hc.png","slug":"Galathil","joinTime":null,"discussionCount":33,"commentCount":35,"canEdit":false,"canDelete":false,"lastSeenAt":"2021-02-17T17:13:27+00:00","canSuspend":false},"relationships":{"groups":{"data":[{"type":"groups","id":"1"},{"type":"groups","id":"4"}]}}},{"type":"users","id":"2","attributes":{"username":"iThorgrim","displayName":"iThorgrim","avatarUrl":"https:\/\/forum.open-wow.eu\/assets\/avatars\/m2uNfA3ykacYo3KQ.png","slug":"iThorgrim","joinTime":null}},{"type":"groups","id":"1","attributes":{"nameSingular":"Administrateur","namePlural":"Administrateurs","color":"#B72A2A","icon":"fas fa-wrench","isHidden":0}},{"type":"groups","id":"4","attributes":{"nameSingular":"Mod\u00e9rateur","namePlural":"Mod\u00e9rateurs","color":"#80349E","icon":"fas fa-bolt","isHidden":0}},{"type":"tags","id":"2","attributes":{"name":"Tutoriels","description":"","slug":"tutoriels","color":"#e74c3c","backgroundUrl":null,"backgroundMode":null,"icon":"","discussionCount":43,"position":2,"defaultSort":null,"isChild":false,"isHidden":false,"lastPostedAt":"2021-02-18T21:11:18+00:00","canStartDiscussion":false,"canAddToDiscussion":false,"postCount":39}}]}});
                flarum.core.app.bootExtensions(flarum.extensions);
                flarum.core.app.boot();
            } catch (e) {
                var error = document.getElementById('flarum-loading-error');
                error.innerHTML += document.getElementById('flarum-content').textContent;
                error.style.display = 'block';
                throw e;
            }
        </script>
</body>
</html>
